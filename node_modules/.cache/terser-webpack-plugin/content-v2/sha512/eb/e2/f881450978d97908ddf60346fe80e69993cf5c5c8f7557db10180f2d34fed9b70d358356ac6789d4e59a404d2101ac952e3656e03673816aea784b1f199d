{"code":"!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=2)}([function(e,t,n){\"use strict\";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split(\"\\n\").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split(\"\\nm=\").map(function(e,t){return(t>0?\"m=\"+e:e).trim()+\"\\r\\n\"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf(\"a=candidate:\")?e.substring(12).split(\" \"):e.substring(10).split(\" \"))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case\"raddr\":n.relatedAddress=t[r+1];break;case\"rport\":n.relatedPort=parseInt(t[r+1],10);break;case\"tcptype\":n.tcpType=t[r+1];break;case\"ufrag\":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push(\"typ\"),t.push(n),\"host\"!==n&&e.relatedAddress&&e.relatedPort&&(t.push(\"raddr\"),t.push(e.relatedAddress),t.push(\"rport\"),t.push(e.relatedPort)),e.tcpType&&\"tcp\"===e.protocol.toLowerCase()&&(t.push(\"tcptype\"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push(\"ufrag\"),t.push(e.usernameFragment||e.ufrag)),\"candidate:\"+t.join(\" \")},r.parseIceOptions=function(e){return e.substr(14).split(\" \")},r.parseRtpMap=function(e){var t=e.substr(9).split(\" \"),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split(\"/\"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return\"a=rtpmap:\"+t+\" \"+e.name+\"/\"+e.clockRate+(1!==n?\"/\"+n:\"\")+\"\\r\\n\"},r.parseExtmap=function(e){var t=e.substr(9).split(\" \");return{id:parseInt(t[0],10),direction:t[0].indexOf(\"/\")>0?t[0].split(\"/\")[1]:\"sendrecv\",uri:t[1]}},r.writeExtmap=function(e){return\"a=extmap:\"+(e.id||e.preferredId)+(e.direction&&\"sendrecv\"!==e.direction?\"/\"+e.direction:\"\")+\" \"+e.uri+\"\\r\\n\"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(\" \")+1).split(\";\"),i=0;i<r.length;i++)n[(t=r[i].trim().split(\"=\"))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t=\"\",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+\"=\"+e.parameters[t]):r.push(t)}),t+=\"a=fmtp:\"+n+\" \"+r.join(\";\")+\"\\r\\n\"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(\" \")+1).split(\" \");return{type:t.shift(),parameter:t.join(\" \")}},r.writeRtcpFb=function(e){var t=\"\",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+=\"a=rtcp-fb:\"+n+\" \"+e.type+(e.parameter&&e.parameter.length?\" \"+e.parameter:\"\")+\"\\r\\n\"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(\" \"),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(\":\",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(\" \");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},r.getMid=function(e){var t=r.matchPrefix(e,\"a=mid:\")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(\" \");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:\"auto\",fingerprints:r.matchPrefix(e+t,\"a=fingerprint:\").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n=\"a=setup:\"+t+\"\\r\\n\";return e.fingerprints.forEach(function(e){n+=\"a=fingerprint:\"+e.algorithm+\" \"+e.value+\"\\r\\n\"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return{usernameFragment:(n=n.concat(r.splitLines(t))).filter(function(e){return 0===e.indexOf(\"a=ice-ufrag:\")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf(\"a=ice-pwd:\")})[0].substr(10)}},r.writeIceParameters=function(e){return\"a=ice-ufrag:\"+e.usernameFragment+\"\\r\\na=ice-pwd:\"+e.password+\"\\r\\n\"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(\" \"),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,\"a=rtpmap:\"+o+\" \")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,\"a=fmtp:\"+o+\" \");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,\"a=rtcp-fb:\"+o+\" \").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case\"RED\":case\"ULPFEC\":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,\"a=extmap:\").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n=\"\";n+=\"m=\"+e+\" \",n+=t.codecs.length>0?\"9\":\"0\",n+=\" UDP/TLS/RTP/SAVPF \",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(\" \")+\"\\r\\n\",n+=\"c=IN IP4 0.0.0.0\\r\\n\",n+=\"a=rtcp:9 IN IP4 0.0.0.0\\r\\n\",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+=\"a=maxptime:\"+i+\"\\r\\n\"),n+=\"a=rtcp-mux\\r\\n\",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf(\"RED\"),a=-1!==i.fecMechanisms.indexOf(\"ULPFEC\"),s=r.matchPrefix(e,\"a=ssrc:\").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return\"cname\"===e.attribute}),c=s.length>0&&s[0].ssrc,d=r.matchPrefix(e,\"a=ssrc-group:FID\").map(function(e){return e.substr(17).split(\" \").map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if(\"RTX\"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:a?\"red+ulpfec\":\"red\"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var p=r.matchPrefix(e,\"b=\");return p.length&&(p=0===p[0].indexOf(\"b=TIAS:\")?parseInt(p[0].substr(7),10):0===p[0].indexOf(\"b=AS:\")?1e3*parseInt(p[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=p})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,\"a=ssrc:\").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return\"cname\"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,\"a=rtcp-rsize\");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,\"a=rtcp-mux\");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,\"a=msid:\");if(1===n.length)return{stream:(t=n[0].substr(7).split(\" \"))[0],track:t[1]};var i=r.matchPrefix(e,\"a=ssrc:\").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return\"msid\"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(\" \"))[0],track:t[1]}:void 0},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i=void 0!==t?t:2;return\"v=0\\r\\no=\"+(n||\"thisisadapterortc\")+\" \"+(e||r.generateSessionId())+\" \"+i+\" IN IP4 127.0.0.1\\r\\ns=-\\r\\nt=0 0\\r\\n\"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),\"offer\"===n?\"actpass\":\"active\"),o+=\"a=mid:\"+e.mid+\"\\r\\n\",e.direction?o+=\"a=\"+e.direction+\"\\r\\n\":e.rtpSender&&e.rtpReceiver?o+=\"a=sendrecv\\r\\n\":e.rtpSender?o+=\"a=sendonly\\r\\n\":e.rtpReceiver?o+=\"a=recvonly\\r\\n\":o+=\"a=inactive\\r\\n\",e.rtpSender){var a=\"msid:\"+i.id+\" \"+e.rtpSender.track.id+\"\\r\\n\";o+=\"a=\"+a,o+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" \"+a,e.sendEncodingParameters[0].rtx&&(o+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" \"+a,o+=\"a=ssrc-group:FID \"+e.sendEncodingParameters[0].ssrc+\" \"+e.sendEncodingParameters[0].rtx.ssrc+\"\\r\\n\")}return o+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" cname:\"+r.localCName+\"\\r\\n\",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" cname:\"+r.localCName+\"\\r\\n\"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case\"a=sendrecv\":case\"a=sendonly\":case\"a=recvonly\":case\"a=inactive\":return n[i].substr(2)}return t?r.getDirection(t):\"sendrecv\"},r.getKind=function(e){return r.splitLines(e)[0].split(\" \")[0].substr(2)},r.isRejected=function(e){return\"0\"===e.split(\" \",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(\" \");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(\" \")}},r.parseOLine=function(e){var t=r.matchPrefix(e,\"o=\")[0].substr(2).split(\" \");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if(\"string\"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||\"=\"!==t[n].charAt(1))return!1;return!0},e.exports=r},function(e,t,n){\"use strict\";var r=n(0);function i(e,t,n,i,o){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),\"offer\"===n?\"actpass\":o||\"active\"),a+=\"a=mid:\"+e.mid+\"\\r\\n\",e.rtpSender&&e.rtpReceiver?a+=\"a=sendrecv\\r\\n\":e.rtpSender?a+=\"a=sendonly\\r\\n\":e.rtpReceiver?a+=\"a=recvonly\\r\\n\":a+=\"a=inactive\\r\\n\",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c=\"msid:\"+(i?i.id:\"-\")+\" \"+s+\"\\r\\n\";a+=\"a=\"+c,a+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" \"+c,e.sendEncodingParameters[0].rtx&&(a+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" \"+c,a+=\"a=ssrc-group:FID \"+e.sendEncodingParameters[0].ssrc+\" \"+e.sendEncodingParameters[0].rtx.ssrc+\"\\r\\n\")}return a+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" cname:\"+r.localCName+\"\\r\\n\",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" cname:\"+r.localCName+\"\\r\\n\"),a}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if(\"rtx\"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:[\"stable\",\"have-local-offer\"],setRemoteDescription:[\"stable\",\"have-remote-offer\"]},answer:{setLocalDescription:[\"have-remote-offer\",\"have-local-pranswer\"],setRemoteDescription:[\"have-local-offer\",\"have-remote-pranswer\"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent(\"addtrack\",{track:t}))}function d(t,n,r,i){var o=new Event(\"track\");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent(\"track\",o)})}var p=function(n){var i=this,o=document.createDocumentFragment();if([\"addEventListener\",\"removeEventListener\",\"dispatchEvent\"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState=\"stable\",this.iceConnectionState=\"new\",this.connectionState=\"new\",this.iceGatheringState=\"new\",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle=\"max-bundle\"===n.bundlePolicy,\"negotiate\"===n.rtcpMuxPolicy)throw c(\"NotSupportedError\",\"rtcpMuxPolicy 'negotiate' is not supported\");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy=\"require\"),n.iceTransportPolicy){case\"all\":case\"relay\":break;default:n.iceTransportPolicy=\"all\"}switch(n.bundlePolicy){case\"balanced\":case\"max-compat\":case\"max-bundle\":break;default:n.bundlePolicy=\"balanced\"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn(\"RTCIceServer.url is deprecated! Use urls instead.\");var i=\"string\"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf(\"turn:\")||-1===e.indexOf(\"transport=udp\")||-1!==e.indexOf(\"turn:[\")||n?0===e.indexOf(\"stun:\")&&t>=14393&&-1===e.indexOf(\"?transport=udp\"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(p.prototype,\"localDescription\",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(p.prototype,\"remoteDescription\",{configurable:!0,get:function(){return this._remoteDescription}}),p.prototype.onicecandidate=null,p.prototype.onaddstream=null,p.prototype.ontrack=null,p.prototype.onremovestream=null,p.prototype.onsignalingstatechange=null,p.prototype.oniceconnectionstatechange=null,p.prototype.onconnectionstatechange=null,p.prototype.onicegatheringstatechange=null,p.prototype.onnegotiationneeded=null,p.prototype.ondatachannel=null,p.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),\"function\"==typeof this[\"on\"+e]&&this[\"on\"+e](t))},p.prototype._emitGatheringStateChange=function(){var e=new Event(\"icegatheringstatechange\");this._dispatchEvent(\"icegatheringstatechange\",e)},p.prototype.getConfiguration=function(){return this._config},p.prototype.getLocalStreams=function(){return this.localStreams},p.prototype.getRemoteStreams=function(){return this.remoteStreams},p.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},p.prototype.addTrack=function(t,n){if(this._isClosed)throw c(\"InvalidStateError\",\"Attempted to call addTrack on a closed peerconnection.\");var r;if(this.transceivers.find(function(e){return e.track===t}))throw c(\"InvalidAccessError\",\"Track already exists.\");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},p.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener(\"enabled\",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},p.prototype.removeTrack=function(t){if(this._isClosed)throw c(\"InvalidStateError\",\"Attempted to call removeTrack on a closed peerconnection.\");if(!(t instanceof e.RTCRtpSender))throw new TypeError(\"Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.\");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw c(\"InvalidAccessError\",\"Sender was not created by this connection.\");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},p.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},p.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},p.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},p.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,\"state\",{value:\"new\",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?\"completed\":\"gathering\",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener(\"localcandidate\",this.transceivers[t].bufferCandidates),i},p.prototype._gather=function(t,n){var i=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener(\"localcandidate\",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var a=new Event(\"icecandidate\");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)\"new\"!==o.state&&\"gathering\"!==o.state||(o.state=\"completed\");else{\"new\"===o.state&&(o.state=\"gathering\"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var d=r.writeCandidate(s);a.candidate=Object.assign(a.candidate,r.parseCandidate(d)),a.candidate.candidate=d,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var p=r.getMediaSections(i._localDescription.sdp);p[a.candidate.sdpMLineIndex]+=c?\"a=end-of-candidates\\r\\n\":\"a=\"+a.candidate.candidate+\"\\r\\n\",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+p.join(\"\");var l=i.transceivers.every(function(e){return e.iceGatherer&&\"completed\"===e.iceGatherer.state});\"gathering\"!==i.iceGatheringState&&(i.iceGatheringState=\"gathering\",i._emitGatheringStateChange()),c||i._dispatchEvent(\"icecandidate\",a),l&&(i._dispatchEvent(\"icecandidate\",new Event(\"icecandidate\")),i.iceGatheringState=\"complete\",i._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){o.onlocalcandidate(e)})},0)}},p.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,\"state\",{value:\"failed\",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},p.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},p.prototype._transceive=function(e,n,i){var a=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&(\"video\"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},p.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===[\"offer\",\"answer\"].indexOf(e.type))return Promise.reject(c(\"TypeError\",'Unsupported type \"'+e.type+'\"'));if(!a(\"setLocalDescription\",e.type,i.signalingState)||i._isClosed)return Promise.reject(c(\"InvalidStateError\",\"Can not set local \"+e.type+\" in state \"+i.signalingState));if(\"offer\"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if(\"answer\"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,\"a=ice-lite\").length>0;t.forEach(function(e,t){var a=i.transceivers[t],c=a.iceGatherer,d=a.iceTransport,p=a.dtlsTransport,l=a.localCapabilities,u=a.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,\"a=bundle-only\").length)&&!a.rejected){var h=r.getIceParameters(e,n),f=r.getDtlsParameters(e,n);s&&(f.role=\"server\"),i.usingBundle&&0!==t||(i._gather(a.mid,t),\"new\"===d.state&&d.start(c,h,s?\"controlling\":\"controlled\"),\"new\"===p.state&&p.start(f));var m=o(l,u);i._transceive(a,m.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},\"offer\"===e.type?i._updateSignalingState(\"have-local-offer\"):i._updateSignalingState(\"stable\"),Promise.resolve()},p.prototype.setRemoteDescription=function(i){var p=this;if(-1===[\"offer\",\"answer\"].indexOf(i.type))return Promise.reject(c(\"TypeError\",'Unsupported type \"'+i.type+'\"'));if(!a(\"setRemoteDescription\",i.type,p.signalingState)||p._isClosed)return Promise.reject(c(\"InvalidStateError\",\"Can not set remote \"+i.type+\" in state \"+p.signalingState));var l={};p.remoteStreams.forEach(function(e){l[e.id]=e});var u=[],h=r.splitSections(i.sdp),f=h.shift(),m=r.matchPrefix(f,\"a=ice-lite\").length>0,v=r.matchPrefix(f,\"a=group:BUNDLE \").length>0;p.usingBundle=v;var g=r.matchPrefix(f,\"a=ice-options:\")[0];return p.canTrickleIceCandidates=!!g&&g.substr(14).split(\" \").indexOf(\"trickle\")>=0,h.forEach(function(a,c){var d=r.splitLines(a),h=r.getKind(a),g=r.isRejected(a)&&0===r.matchPrefix(a,\"a=bundle-only\").length,y=d[0].substr(2).split(\" \")[2],C=r.getDirection(a,f),S=r.parseMsid(a),b=r.getMid(a)||r.generateIdentifier();if(g||\"application\"===h&&(\"DTLS/SCTP\"===y||\"UDP/DTLS/SCTP\"===y))p.transceivers[c]={mid:b,kind:h,protocol:y,rejected:!0};else{var T,x,R,w,E,P,k,_,M;!g&&p.transceivers[c]&&p.transceivers[c].rejected&&(p.transceivers[c]=p._createTransceiver(h,!0));var O,I,D=r.parseRtpParameters(a);g||(O=r.getIceParameters(a,f),(I=r.getDtlsParameters(a,f)).role=\"client\"),k=r.parseRtpEncodingParameters(a);var L=r.parseRtcpParameters(a),j=r.matchPrefix(a,\"a=end-of-candidates\",f).length>0,A=r.matchPrefix(a,\"a=candidate:\").map(function(e){return r.parseCandidate(e)}).filter(function(e){return 1===e.component});if((\"offer\"===i.type||\"answer\"===i.type)&&!g&&v&&c>0&&p.transceivers[c]&&(p._disposeIceAndDtlsTransports(c),p.transceivers[c].iceGatherer=p.transceivers[0].iceGatherer,p.transceivers[c].iceTransport=p.transceivers[0].iceTransport,p.transceivers[c].dtlsTransport=p.transceivers[0].dtlsTransport,p.transceivers[c].rtpSender&&p.transceivers[c].rtpSender.setTransport(p.transceivers[0].dtlsTransport),p.transceivers[c].rtpReceiver&&p.transceivers[c].rtpReceiver.setTransport(p.transceivers[0].dtlsTransport)),\"offer\"!==i.type||g){if(\"answer\"===i.type&&!g){x=(T=p.transceivers[c]).iceGatherer,R=T.iceTransport,w=T.dtlsTransport,E=T.rtpReceiver,P=T.sendEncodingParameters,_=T.localCapabilities,p.transceivers[c].recvEncodingParameters=k,p.transceivers[c].remoteCapabilities=D,p.transceivers[c].rtcpParameters=L,A.length&&\"new\"===R.state&&(!m&&!j||v&&0!==c?A.forEach(function(e){s(T.iceTransport,e)}):R.setRemoteCandidates(A)),v&&0!==c||(\"new\"===R.state&&R.start(x,O,\"controlling\"),\"new\"===w.state&&w.start(I)),!o(T.localCapabilities,T.remoteCapabilities).codecs.filter(function(e){return\"rtx\"===e.name.toLowerCase()}).length&&T.sendEncodingParameters[0].rtx&&delete T.sendEncodingParameters[0].rtx,p._transceive(T,\"sendrecv\"===C||\"recvonly\"===C,\"sendrecv\"===C||\"sendonly\"===C),!E||\"sendrecv\"!==C&&\"sendonly\"!==C?delete T.rtpReceiver:(M=E.track,S?(l[S.stream]||(l[S.stream]=new e.MediaStream),n(M,l[S.stream]),u.push([M,E,l[S.stream]])):(l.default||(l.default=new e.MediaStream),n(M,l.default),u.push([M,E,l.default])))}}else{(T=p.transceivers[c]||p._createTransceiver(h)).mid=b,T.iceGatherer||(T.iceGatherer=p._createIceGatherer(c,v)),A.length&&\"new\"===T.iceTransport.state&&(!j||v&&0!==c?A.forEach(function(e){s(T.iceTransport,e)}):T.iceTransport.setRemoteCandidates(A)),_=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(_.codecs=_.codecs.filter(function(e){return\"rtx\"!==e.name})),P=T.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N,F=!1;if(\"sendrecv\"===C||\"sendonly\"===C){if(F=!T.rtpReceiver,E=T.rtpReceiver||new e.RTCRtpReceiver(T.dtlsTransport,h),F)M=E.track,S&&\"-\"===S.stream||(S?(l[S.stream]||(l[S.stream]=new e.MediaStream,Object.defineProperty(l[S.stream],\"id\",{get:function(){return S.stream}})),Object.defineProperty(M,\"id\",{get:function(){return S.track}}),N=l[S.stream]):(l.default||(l.default=new e.MediaStream),N=l.default)),N&&(n(M,N),T.associatedRemoteMediaStreams.push(N)),u.push([M,E,N])}else T.rtpReceiver&&T.rtpReceiver.track&&(T.associatedRemoteMediaStreams.forEach(function(t){var n,r,i=t.getTracks().find(function(e){return e.id===T.rtpReceiver.track.id});i&&(n=i,(r=t).removeTrack(n),r.dispatchEvent(new e.MediaStreamTrackEvent(\"removetrack\",{track:n})))}),T.associatedRemoteMediaStreams=[]);T.localCapabilities=_,T.remoteCapabilities=D,T.rtpReceiver=E,T.rtcpParameters=L,T.sendEncodingParameters=P,T.recvEncodingParameters=k,p._transceive(p.transceivers[c],!1,F)}}}),void 0===p._dtlsRole&&(p._dtlsRole=\"offer\"===i.type?\"active\":\"passive\"),p._remoteDescription={type:i.type,sdp:i.sdp},\"offer\"===i.type?p._updateSignalingState(\"have-remote-offer\"):p._updateSignalingState(\"stable\"),Object.keys(l).forEach(function(t){var n=l[t];if(n.getTracks().length){if(-1===p.remoteStreams.indexOf(n)){p.remoteStreams.push(n);var r=new Event(\"addstream\");r.stream=n,e.setTimeout(function(){p._dispatchEvent(\"addstream\",r)})}u.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&d(p,t,r,[n])})}}),u.forEach(function(e){e[2]||d(p,e[0],e[1],[])}),e.setTimeout(function(){p&&p.transceivers&&p.transceivers.forEach(function(e){e.iceTransport&&\"new\"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn(\"Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification\"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},p.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState(\"closed\")},p.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event(\"signalingstatechange\");this._dispatchEvent(\"signalingstatechange\",t)},p.prototype._maybeFireNegotiationNeeded=function(){var t=this;\"stable\"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event(\"negotiationneeded\");t._dispatchEvent(\"negotiationneeded\",e)}},0))},p.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e=\"new\",t.failed>0?e=\"failed\":t.checking>0?e=\"checking\":t.disconnected>0?e=\"disconnected\":t.new>0?e=\"new\":t.connected>0?e=\"connected\":t.completed>0&&(e=\"completed\"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event(\"iceconnectionstatechange\");this._dispatchEvent(\"iceconnectionstatechange\",n)}},p.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e=\"new\",t.failed>0?e=\"failed\":t.connecting>0?e=\"connecting\":t.disconnected>0?e=\"disconnected\":t.new>0?e=\"new\":t.connected>0&&(e=\"connected\"),e!==this.connectionState){this.connectionState=e;var n=new Event(\"connectionstatechange\");this._dispatchEvent(\"connectionstatechange\",n)}},p.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c(\"InvalidStateError\",\"Can not call createOffer after close\"));var o=n.transceivers.filter(function(e){return\"audio\"===e.kind}).length,a=n.transceivers.filter(function(e){return\"video\"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError(\"Legacy mandatory/optional constraints not supported.\");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){\"audio\"===e.kind?--o<0&&(e.wantReceive=!1):\"video\"===e.kind&&--a<0&&(e.wantReceive=!1)});o>0||a>0;)o>0&&(n._createTransceiver(\"audio\"),o--),a>0&&(n._createTransceiver(\"video\"),a--);var d=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(i,o){var a=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(o,n.usingBundle));var d=e.RTCRtpSender.getCapabilities(s);t<15019&&(d.codecs=d.codecs.filter(function(e){return\"rtx\"!==e.name})),d.codecs.forEach(function(e){\"H264\"===e.name&&void 0===e.parameters[\"level-asymmetry-allowed\"]&&(e.parameters[\"level-asymmetry-allowed\"]=\"1\"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),d.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var p=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&\"video\"===s&&!p[0].rtx&&(p[0].rtx={ssrc:p[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=d,i.sendEncodingParameters=p}),\"max-compat\"!==n._config.bundlePolicy&&(d+=\"a=group:BUNDLE \"+n.transceivers.map(function(e){return e.mid}).join(\" \")+\"\\r\\n\"),d+=\"a=ice-options:trickle\\r\\n\",n.transceivers.forEach(function(e,t){d+=i(e,e.localCapabilities,\"offer\",e.stream,n._dtlsRole),d+=\"a=rtcp-rsize\\r\\n\",!e.iceGatherer||\"new\"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,d+=\"a=\"+r.writeCandidate(e)+\"\\r\\n\"}),\"completed\"===e.iceGatherer.state&&(d+=\"a=end-of-candidates\\r\\n\"))});var p=new e.RTCSessionDescription({type:\"offer\",sdp:d});return Promise.resolve(p)},p.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c(\"InvalidStateError\",\"Can not call createAnswer after close\"));if(\"have-remote-offer\"!==n.signalingState&&\"have-local-pranswer\"!==n.signalingState)return Promise.reject(c(\"InvalidStateError\",\"Can not call createAnswer in signalingState \"+n.signalingState));var a=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(a+=\"a=group:BUNDLE \"+n.transceivers.map(function(e){return e.mid}).join(\" \")+\"\\r\\n\"),a+=\"a=ice-options:trickle\\r\\n\";var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,r){if(!(r+1>s)){if(e.rejected)return\"application\"===e.kind?\"DTLS/SCTP\"===e.protocol?a+=\"m=application 0 DTLS/SCTP 5000\\r\\n\":a+=\"m=application 0 \"+e.protocol+\" webrtc-datachannel\\r\\n\":\"audio\"===e.kind?a+=\"m=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\na=rtpmap:0 PCMU/8000\\r\\n\":\"video\"===e.kind&&(a+=\"m=video 0 UDP/TLS/RTP/SAVPF 120\\r\\na=rtpmap:120 VP8/90000\\r\\n\"),void(a+=\"c=IN IP4 0.0.0.0\\r\\na=inactive\\r\\na=mid:\"+e.mid+\"\\r\\n\");var c;if(e.stream)\"audio\"===e.kind?c=e.stream.getAudioTracks()[0]:\"video\"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&\"video\"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var d=o(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter(function(e){return\"rtx\"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,d,\"answer\",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+=\"a=rtcp-rsize\\r\\n\")}});var d=new e.RTCSessionDescription({type:\"answer\",sdp:a});return Promise.resolve(d)},p.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError(\"sdpMLineIndex or sdpMid required\")):new Promise(function(i,o){if(!n._remoteDescription)return o(c(\"InvalidStateError\",\"Can not add ICE candidate without a remote description\"));if(e&&\"\"!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var d=0;d<n.transceivers.length;d++)if(n.transceivers[d].mid===e.sdpMid){a=d;break}var p=n.transceivers[a];if(!p)return o(c(\"OperationError\",\"Can not add ICE candidate\"));if(p.rejected)return i();var l=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if(\"tcp\"===l.protocol&&(0===l.port||9===l.port))return i();if(l.component&&1!==l.component)return i();if((0===a||a>0&&p.iceTransport!==n.transceivers[0].iceTransport)&&!s(p.iceTransport,l))return o(c(\"OperationError\",\"Can not add ICE candidate\"));var u=e.candidate.trim();0===u.indexOf(\"a=\")&&(u=u.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[a]+=\"a=\"+(l.type?u:\"end-of-candidates\")+\"\\r\\n\",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(\"\")}else for(var h=0;h<n.transceivers.length&&(n.transceivers[h].rejected||(n.transceivers[h].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[h]+=\"a=end-of-candidates\\r\\n\",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(\"\"),!n.usingBundle));h++);i()})},p.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw c(\"InvalidAccessError\",\"Invalid selector.\");return n.getStats()}var r=[];return this.transceivers.forEach(function(e){[\"rtpSender\",\"rtpReceiver\",\"iceGatherer\",\"iceTransport\",\"dtlsTransport\"].forEach(function(t){e[t]&&r.push(e[t].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};[\"RTCRtpSender\",\"RTCRtpReceiver\",\"RTCIceGatherer\",\"RTCIceTransport\",\"RTCDtlsTransport\"].forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){var r;e[n].type={inboundrtp:\"inbound-rtp\",outboundrtp:\"outbound-rtp\",candidatepair:\"candidate-pair\",localcandidate:\"local-candidate\",remotecandidate:\"remote-candidate\"}[(r=e[n]).type]||r.type,t.set(n,e[n])}),t})}}});var l=[\"createOffer\",\"createAnswer\"];return l.forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return\"function\"==typeof e[0]||\"function\"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){\"function\"==typeof e[0]&&e[0].apply(null,[t])},function(t){\"function\"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(l=[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"]).forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return\"function\"==typeof e[1]||\"function\"==typeof e[2]?t.apply(this,arguments).then(function(){\"function\"==typeof e[1]&&e[1].apply(null)},function(t){\"function\"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),[\"getStats\"].forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return\"function\"==typeof e[1]?t.apply(this,arguments).then(function(){\"function\"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),p}},function(e,t,n){\"use strict\";n.r(t);var r={};n.r(r),n.d(r,\"shimGetUserMedia\",function(){return S}),n.d(r,\"shimGetDisplayMedia\",function(){return b}),n.d(r,\"shimMediaStream\",function(){return T}),n.d(r,\"shimOnTrack\",function(){return x}),n.d(r,\"shimGetSendersWithDtmf\",function(){return R}),n.d(r,\"shimGetStats\",function(){return w}),n.d(r,\"shimSenderReceiverGetStats\",function(){return E}),n.d(r,\"shimAddTrackRemoveTrackWithNative\",function(){return P}),n.d(r,\"shimAddTrackRemoveTrack\",function(){return k}),n.d(r,\"shimPeerConnection\",function(){return _}),n.d(r,\"fixNegotiationNeeded\",function(){return M});var i={};n.r(i),n.d(i,\"shimGetUserMedia\",function(){return D}),n.d(i,\"shimGetDisplayMedia\",function(){return L}),n.d(i,\"shimPeerConnection\",function(){return j}),n.d(i,\"shimReplaceTrack\",function(){return A});var o={};n.r(o),n.d(o,\"shimGetUserMedia\",function(){return N}),n.d(o,\"shimGetDisplayMedia\",function(){return F}),n.d(o,\"shimOnTrack\",function(){return G}),n.d(o,\"shimPeerConnection\",function(){return V}),n.d(o,\"shimSenderGetStats\",function(){return U}),n.d(o,\"shimReceiverGetStats\",function(){return W}),n.d(o,\"shimRemoveStream\",function(){return B}),n.d(o,\"shimRTCDataChannel\",function(){return $});var a={};n.r(a),n.d(a,\"shimLocalStreamsAPI\",function(){return J}),n.d(a,\"shimRemoteStreamsAPI\",function(){return z}),n.d(a,\"shimCallbacksAPI\",function(){return K}),n.d(a,\"shimGetUserMedia\",function(){return X}),n.d(a,\"shimConstraints\",function(){return H}),n.d(a,\"shimRTCIceServerUrls\",function(){return q}),n.d(a,\"shimTrackEventTransceiver\",function(){return Z}),n.d(a,\"shimCreateOfferLegacy\",function(){return Q});var s={};n.r(s),n.d(s,\"shimRTCIceCandidate\",function(){return te}),n.d(s,\"shimMaxMessageSize\",function(){return ne}),n.d(s,\"shimSendThrowTypeError\",function(){return re}),n.d(s,\"shimConnectionState\",function(){return ie}),n.d(s,\"removeAllowExtmapMixed\",function(){return oe});let c=!0,d=!0;function p(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function l(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);const r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,\"on\"+t,{get(){return this[\"_on\"+t]},set(e){this[\"_on\"+t]&&(this.removeEventListener(t,this[\"_on\"+t]),delete this[\"_on\"+t]),e&&this.addEventListener(t,this[\"_on\"+t]=e)},enumerable:!0,configurable:!0})}function u(e){return\"boolean\"!=typeof e?new Error(\"Argument type: \"+typeof e+\". Please use a boolean.\"):(c=e,e?\"adapter.js logging disabled\":\"adapter.js logging enabled\")}function h(e){return\"boolean\"!=typeof e?new Error(\"Argument type: \"+typeof e+\". Please use a boolean.\"):(d=!e,\"adapter.js deprecation warnings \"+(e?\"disabled\":\"enabled\"))}function f(){if(\"object\"==typeof window){if(c)return;\"undefined\"!=typeof console&&\"function\"==typeof console.log&&console.log.apply(console,arguments)}}function m(e,t){d&&console.warn(e+\" is deprecated, please use \"+t+\" instead.\")}function v(e){const{navigator:t}=e,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser=\"Not a browser.\",n;if(t.mozGetUserMedia)n.browser=\"firefox\",n.version=p(t.userAgent,/Firefox\\/(\\d+)\\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)n.browser=\"chrome\",n.version=p(t.userAgent,/Chrom(e|ium)\\/(\\d+)\\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\\/(\\d+).(\\d+)$/))n.browser=\"edge\",n.version=p(t.userAgent,/Edge\\/(\\d+).(\\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\\/(\\d+)\\./))return n.browser=\"Not a supported browser.\",n;n.browser=\"safari\",n.version=p(t.userAgent,/AppleWebKit\\/(\\d+)\\./,1)}return n}function g(e){return\"object\"!=typeof e?e:Object.keys(e).reduce(function(t,n){const r=\"object\"==typeof e[n],i=r?g(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})},{})}function y(e,t,n){const r=n?\"outbound-rtp\":\"inbound-rtp\",i=new Map;if(null===t)return i;const o=[];return e.forEach(e=>{\"track\"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(t=>{e.forEach(n=>{n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach(i=>{i.endsWith(\"Id\")?e(t,t.get(n[i]),r):i.endsWith(\"Ids\")&&n[i].forEach(n=>{e(t,t.get(n),r)})}))}(e,n,i)})}),i}const C=f;function S(e){const t=e&&e.navigator;if(!t.mediaDevices)return;const n=v(e),r=function(e){if(\"object\"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if(\"require\"===n||\"advanced\"===n||\"mediaSource\"===n)return;const r=\"object\"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&\"number\"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):\"deviceId\"===t?\"sourceId\":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};\"number\"==typeof r.ideal?(e[i(\"min\",n)]=r.ideal,t.optional.push(e),(e={})[i(\"max\",n)]=r.ideal,t.optional.push(e)):(e[i(\"\",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&\"number\"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i(\"\",n)]=r.exact):[\"min\",\"max\"].forEach(e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(n.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&\"object\"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,\"autoGainControl\",\"googAutoGainControl\"),t(e.audio,\"noiseSuppression\",\"googNoiseSuppression\"),e.audio=r(e.audio)}if(e&&\"object\"==typeof e.video){let o=e.video.facingMode;o=o&&(\"object\"==typeof o?o:{ideal:o});const a=n.version<66;if(o&&(\"user\"===o.exact||\"environment\"===o.exact||\"user\"===o.ideal||\"environment\"===o.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||a)){let n;if(delete e.video.facingMode,\"environment\"===o.exact||\"environment\"===o.ideal?n=[\"back\",\"rear\"]:\"user\"!==o.exact&&\"user\"!==o.ideal||(n=[\"front\"]),n)return t.mediaDevices.enumerateDevices().then(t=>{let a=(t=t.filter(e=>\"videoinput\"===e.kind)).find(e=>n.some(t=>e.label.toLowerCase().includes(t)));return!a&&t.length&&n.includes(\"back\")&&(a=t[t.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),C(\"chrome: \"+JSON.stringify(e)),i(e)})}e.video=r(e.video)}return C(\"chrome: \"+JSON.stringify(e)),i(e)},o=function(e){return n.version>=64?e:{name:{PermissionDeniedError:\"NotAllowedError\",PermissionDismissedError:\"NotAllowedError\",InvalidStateError:\"NotAllowedError\",DevicesNotFoundError:\"NotFoundError\",ConstraintNotSatisfiedError:\"OverconstrainedError\",TrackStartError:\"NotReadableError\",MediaDeviceFailedDueToShutdown:\"NotAllowedError\",MediaDeviceKillSwitchOn:\"NotAllowedError\",TabCaptureError:\"AbortError\",ScreenCaptureError:\"AbortError\",DeviceCaptureError:\"AbortError\"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&\": \")+this.message}}};if(t.getUserMedia=function(e,n,r){i(e,e=>{t.webkitGetUserMedia(e,n,e=>{r&&r(o(e))})})}.bind(t),t.mediaDevices.getUserMedia){const e=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException(\"\",\"NotFoundError\");return e},e=>Promise.reject(o(e))))}}}function b(e,t){e.navigator.mediaDevices&&\"getDisplayMedia\"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(\"function\"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:\"desktop\",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error(\"shimGetDisplayMedia: getSourceId argument is not a function\"))}function T(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function x(e){if(\"object\"!=typeof e||!e.RTCPeerConnection||\"ontrack\"in e.RTCPeerConnection.prototype)l(e,\"track\",e=>(e.transceiver||Object.defineProperty(e,\"transceiver\",{value:{receiver:e.receiver}}),e));else{Object.defineProperty(e.RTCPeerConnection.prototype,\"ontrack\",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener(\"track\",this._ontrack),this.addEventListener(\"track\",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=(t=>{t.stream.addEventListener(\"addtrack\",n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const i=new Event(\"track\");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const i=new Event(\"track\");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})}),this.addEventListener(\"addstream\",this._ontrackpoly)),t.apply(this,arguments)}}}function R(e){if(\"object\"==typeof e&&e.RTCPeerConnection&&!(\"getSenders\"in e.RTCPeerConnection.prototype)&&\"createDTMFSender\"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&(\"audio\"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if(\"object\"==typeof e&&e.RTCPeerConnection&&\"getSenders\"in e.RTCPeerConnection.prototype&&\"createDTMFSender\"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!(\"dtmf\"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,\"dtmf\",{get(){return void 0===this._dtmf&&(\"audio\"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function w(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){const i=arguments;if(arguments.length>0&&\"function\"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||\"function\"!=typeof arguments[0]))return t.apply(this,[]);const o=function(e){const t={};return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:\"local-candidate\",remotecandidate:\"remote-candidate\"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const e=function(e){i[1](a(o(e)))};return t.apply(this,[e,arguments[0]])}return new Promise((e,n)=>{t.apply(this,[function(t){e(a(o(t)))},n])}).then(n,r)}}function E(e){if(!(\"object\"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!(\"getStats\"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>y(t,e.track,!0))}}if(!(\"getStats\"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),l(e,\"track\",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>y(t,e.track,!1))}}if(!(\"getStats\"in e.RTCRtpSender.prototype&&\"getStats\"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach(n=>{n.track===e&&(t?r=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?r=!0:n=t),t.track===e)),r||t&&n?Promise.reject(new DOMException(\"There are more than one sender or receiver for the track.\",\"InvalidAccessError\")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException(\"There is no sender or receiver for the track.\",\"InvalidAccessError\"))}return t.apply(this,arguments)}}function P(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException(\"Track already exists.\",\"InvalidAccessError\")});const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function k(e){if(!e.RTCPeerConnection)return;const t=v(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return P(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException(\"Track already exists.\",\"InvalidAccessError\")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,\"g\"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if(\"closed\"===this.signalingState)throw new DOMException(\"The RTCPeerConnection's signalingState is 'closed'.\",\"InvalidStateError\");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(e=>e===t))throw new DOMException(\"The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.\",\"NotSupportedError\");if(this.getSenders().find(e=>e.track===t))throw new DOMException(\"Track already exists.\",\"InvalidAccessError\");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[n.id];if(i)i.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event(\"negotiationneeded\"))});else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find(e=>e.track===t)},[\"createOffer\",\"createAnswer\"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){const e=arguments;return arguments.length&&\"function\"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>o(this,e))}});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,\"g\"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,\"localDescription\");Object.defineProperty(e.RTCPeerConnection.prototype,\"localDescription\",{get(){const e=s.get.apply(this);return\"\"===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if(\"closed\"===this.signalingState)throw new DOMException(\"The RTCPeerConnection's signalingState is 'closed'.\",\"InvalidStateError\");if(!e._pc)throw new DOMException(\"Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.\",\"TypeError\");if(!(e._pc===this))throw new DOMException(\"Sender was not created by this connection.\",\"InvalidAccessError\");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event(\"negotiationneeded\")))}}function _(e){if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!e.RTCPeerConnection)return;[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new(\"addIceCandidate\"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});const t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}function M(e){l(e,\"negotiationneeded\",e=>{if(\"stable\"===e.target.signalingState)return e})}var O=n(1),I=n.n(O);function D(e){const t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(e=>Promise.reject(function(e){return{name:{PermissionDeniedError:\"NotAllowedError\"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e)))}}function L(e){\"getDisplayMedia\"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&\"getDisplayMedia\"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function j(e){const t=v(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,\"enabled\");Object.defineProperty(e.MediaStreamTrack.prototype,\"enabled\",{set(e){t.set.call(this,e);const n=new Event(\"enabled\");n.enabled=e,this.dispatchEvent(n)}})}!e.RTCRtpSender||\"dtmf\"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,\"dtmf\",{get(){return void 0===this._dtmf&&(\"audio\"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):\"video\"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const n=I()(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(e=>{if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&m(\"RTCIceServer.url\",\"RTCIceServer.urls\");const r=\"string\"==typeof t;return r&&(t=[t]),t=t.filter(e=>{if(0===e.indexOf(\"stun:\"))return!1;const t=e.startsWith(\"turn\")&&!e.startsWith(\"turn:[\")&&e.includes(\"transport=udp\");return t&&!n?(n=!0,!0):t&&!n}),delete e.url,e.urls=r?t[0]:t,!!t.length}})}(e.iceServers,t.version),f(\"ICE servers after filtering:\",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function A(e){!e.RTCRtpSender||\"replaceTrack\"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}function N(e){const t=v(e),n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){m(\"navigator.getUserMedia\",\"navigator.mediaDevices.getUserMedia\"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&\"autoGainControl\"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return\"object\"==typeof n&&\"object\"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,\"autoGainControl\",\"mozAutoGainControl\"),e(n.audio,\"noiseSuppression\",\"mozNoiseSuppression\")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,\"mozAutoGainControl\",\"autoGainControl\"),e(n,\"mozNoiseSuppression\",\"noiseSuppression\"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return\"audio\"===this.kind&&\"object\"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,\"autoGainControl\",\"mozAutoGainControl\"),e(n,\"noiseSuppression\",\"mozNoiseSuppression\")),t.apply(this,[n])}}}}function F(e,t){e.navigator.mediaDevices&&\"getDisplayMedia\"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException(\"getDisplayMedia without video constraints is undefined\");return e.name=\"NotFoundError\",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function G(e){\"object\"==typeof e&&e.RTCTrackEvent&&\"receiver\"in e.RTCTrackEvent.prototype&&!(\"transceiver\"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,\"transceiver\",{get(){return{receiver:this.receiver}}})}function V(e){const t=v(e);if(\"object\"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new(\"addIceCandidate\"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});const n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};const r={inboundrtp:\"inbound-rtp\",outboundrtp:\"outbound-rtp\",candidatepair:\"candidate-pair\",localcandidate:\"local-candidate\",remotecandidate:\"remote-candidate\"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,o){return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!n)try{e.forEach(e=>{e.type=r[e.type]||e.type})}catch(t){if(\"TypeError\"!==t.name)throw t;e.forEach((t,n)=>{e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))})}return e}).then(n,o)}}function U(e){if(\"object\"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&\"getStats\"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function W(e){if(\"object\"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&\"getStats\"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),l(e,\"track\",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function B(e){!e.RTCPeerConnection||\"removeStream\"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){m(\"removeStream\",\"removeTrack\"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function $(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function J(e){if(\"object\"==typeof e&&e.RTCPeerConnection){if(\"getLocalStreams\"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!(\"addStream\"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e,n){return n&&(this._localStreams?this._localStreams.includes(n)||this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}\"removeStream\"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function z(e){if(\"object\"==typeof e&&e.RTCPeerConnection&&(\"getRemoteStreams\"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!(\"onaddstream\"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,\"onaddstream\",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener(\"addstream\",this._onaddstream),this.removeEventListener(\"track\",this._onaddstreampoly)),this.addEventListener(\"addstream\",this._onaddstream=e),this.addEventListener(\"track\",this._onaddstreampoly=(e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event(\"addstream\");t.stream=e,this.dispatchEvent(t)})}))}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener(\"track\",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event(\"addstream\");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function K(e){if(\"object\"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}function X(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=(e=>n(H(e)))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function H(e){return e&&void 0!==e.video?Object.assign({},e,{video:g(e.video)}):e}function q(e){const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty(\"urls\")&&r.hasOwnProperty(\"url\")?(m(\"RTCIceServer.url\",\"RTCIceServer.urls\"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,\"generateCertificate\"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,\"generateCertificate\",{get:()=>t.generateCertificate})}function Z(e){\"object\"==typeof e&&e.RTCPeerConnection&&\"receiver\"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,\"transceiver\",{get(){return{receiver:this.receiver}}})}function Q(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>\"audio\"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?\"sendrecv\"===t.direction?t.setDirection?t.setDirection(\"sendonly\"):t.direction=\"sendonly\":\"recvonly\"===t.direction&&(t.setDirection?t.setDirection(\"inactive\"):t.direction=\"inactive\"):!0!==e.offerToReceiveAudio||t||this.addTransceiver(\"audio\"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>\"video\"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?\"sendrecv\"===n.direction?n.setDirection?n.setDirection(\"sendonly\"):n.direction=\"sendonly\":\"recvonly\"===n.direction&&(n.setDirection?n.setDirection(\"inactive\"):n.direction=\"inactive\"):!0!==e.offerToReceiveVideo||n||this.addTransceiver(\"video\")}return t.apply(this,arguments)}}var Y=n(0),ee=n.n(Y);function te(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&\"foundation\"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if(\"object\"==typeof e&&e.candidate&&0===e.candidate.indexOf(\"a=\")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=ee.a.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,l(e,\"icecandidate\",t=>(t.candidate&&Object.defineProperty(t,\"candidate\",{value:new e.RTCIceCandidate(t.candidate),writable:\"false\"}),t))}function ne(e){if(e.RTCSctpTransport||!e.RTCPeerConnection)return;const t=v(e);\"sctp\"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,\"sctp\",{get(){return void 0===this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,function(e){if(!e||!e.sdp)return!1;const t=ee.a.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=ee.a.parseMLine(e);return t&&\"application\"===t.kind&&-1!==t.protocol.indexOf(\"SCTP\")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return\"firefox\"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),r=function(e,n){let r=65536;\"firefox\"===t.browser&&57===t.version&&(r=65535);const i=ee.a.matchPrefix(e.sdp,\"a=max-message-size:\");return i.length>0?r=parseInt(i[0].substr(19),10):\"firefox\"===t.browser&&-1!==n&&(r=2147483637),r}(arguments[0],e);let i;i=0===n&&0===r?Number.POSITIVE_INFINITY:0===n||0===r?Math.max(n,r):Math.min(n,r);const o={};Object.defineProperty(o,\"maxMessageSize\",{get:()=>i}),this._sctp=o}return n.apply(this,arguments)}}function re(e){if(!(e.RTCPeerConnection&&\"createDataChannel\"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if(\"open\"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError(\"Message too large (can send a maximum of \"+t.sctp.maxMessageSize+\" bytes)\");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},l(e,\"datachannel\",e=>(t(e.channel,e.target),e))}function ie(e){if(!e.RTCPeerConnection||\"connectionState\"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,\"connectionState\",{get(){return{completed:\"connected\",checking:\"connecting\"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"onconnectionstatechange\",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener(\"connectionstatechange\",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener(\"connectionstatechange\",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),[\"setLocalDescription\",\"setRemoteDescription\"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=(e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event(\"connectionstatechange\",e);t.dispatchEvent(n)}return e}),this.addEventListener(\"iceconnectionstatechange\",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function oe(e){if(!e.RTCPeerConnection)return;const t=v(e);if(\"chrome\"===t.browser&&t.version>=71)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf(\"\\na=extmap-allow-mixed\")&&(e.sdp=e.sdp.split(\"\\n\").filter(e=>\"a=extmap-allow-mixed\"!==e.trim()).join(\"\\n\")),n.apply(this,arguments)}}!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=f,c=v(e),d={browserDetails:c,commonShim:s,extractVersion:p,disableLog:u,disableWarnings:h};switch(c.browser){case\"chrome\":if(!r||!_||!t.shimChrome)return n(\"Chrome shim is not included in this adapter release.\"),d;n(\"adapter.js shimming chrome.\"),d.browserShim=r,S(e),T(e),_(e),x(e),k(e),R(e),w(e),E(e),M(e),te(e),ie(e),ne(e),re(e),oe(e);break;case\"firefox\":if(!o||!V||!t.shimFirefox)return n(\"Firefox shim is not included in this adapter release.\"),d;n(\"adapter.js shimming firefox.\"),d.browserShim=o,N(e),V(e),G(e),B(e),U(e),W(e),$(e),te(e),ie(e),ne(e),re(e);break;case\"edge\":if(!i||!j||!t.shimEdge)return n(\"MS edge shim is not included in this adapter release.\"),d;n(\"adapter.js shimming edge.\"),d.browserShim=i,D(e),L(e),j(e),A(e),ne(e),re(e);break;case\"safari\":if(!a||!t.shimSafari)return n(\"Safari shim is not included in this adapter release.\"),d;n(\"adapter.js shimming safari.\"),d.browserShim=a,q(e),Q(e),K(e),J(e),z(e),Z(e),X(e),te(e),ne(e),re(e),oe(e);break;default:n(\"Unsupported browser!\")}}({window:window});const ae=\"3.3.8\";var se=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:{};function ce(e,t){return e(t={exports:{}},t.exports),t.exports}var de,pe=ce(function(e,t){(function(){var n={function:!0,object:!0}[typeof window]&&window||this,r=t,i=e&&!e.nodeType&&e,o=r&&i&&\"object\"==typeof se&&se;!o||o.global!==o&&o.window!==o&&o.self!==o||(n=o);var a=Math.pow(2,53)-1,s=/\\bOpera/,c=Object.prototype,d=c.hasOwnProperty,p=c.toString;function l(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function u(e){return e=g(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:l(e)}function h(e,t){for(var n in e)d.call(e,n)&&t(e[n],n,e)}function f(e){return null==e?l(e):p.call(e).slice(8,-1)}function m(e){return String(e).replace(/([ -])(?!$)/g,\"$1?\")}function v(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if(\"number\"==typeof r&&r>-1&&r<=a)for(;++n<r;)t(e[n],n);else h(e,t)}(e,function(r,i){n=t(n,r,i,e)}),n}function g(e){return String(e).replace(/^ +| +$/g,\"\")}var y=function e(t){var r=n,i=t&&\"object\"==typeof t&&\"String\"!=f(t);i&&(r=t,t=null);var o=r.navigator||{},a=o.userAgent||\"\";t||(t=a);var c,d,l,y,C,S=i?!!o.likeChrome:/\\bChrome\\b/.test(t)&&!/internal|\\n/i.test(p.toString()),b=i?\"Object\":\"ScriptBridgingProxyObject\",T=i?\"Object\":\"Environment\",x=i&&r.java?\"JavaPackage\":f(r.java),R=i?\"Object\":\"RuntimeObject\",w=/\\bJava/.test(x)&&r.java,E=w&&f(r.environment)==T,P=w?\"a\":\"\",k=w?\"b\":\"\",_=r.document||{},M=r.operamini||r.opera,O=s.test(O=i&&M?M[\"[[Class]]\"]:f(M))?O:M=null,I=t,D=[],L=null,j=t==a,A=j&&M&&\"function\"==typeof M.version&&M.version(),N=v([{label:\"EdgeHTML\",pattern:\"Edge\"},\"Trident\",{label:\"WebKit\",pattern:\"AppleWebKit\"},\"iCab\",\"Presto\",\"NetFront\",\"Tasman\",\"KHTML\",\"Gecko\"],function(e,n){return e||RegExp(\"\\\\b\"+(n.pattern||m(n))+\"\\\\b\",\"i\").exec(t)&&(n.label||n)}),F=v([\"Adobe AIR\",\"Arora\",\"Avant Browser\",\"Breach\",\"Camino\",\"Electron\",\"Epiphany\",\"Fennec\",\"Flock\",\"Galeon\",\"GreenBrowser\",\"iCab\",\"Iceweasel\",\"K-Meleon\",\"Konqueror\",\"Lunascape\",\"Maxthon\",{label:\"Microsoft Edge\",pattern:\"Edge\"},\"Midori\",\"Nook Browser\",\"PaleMoon\",\"PhantomJS\",\"Raven\",\"Rekonq\",\"RockMelt\",{label:\"Samsung Internet\",pattern:\"SamsungBrowser\"},\"SeaMonkey\",{label:\"Silk\",pattern:\"(?:Cloud9|Silk-Accelerated)\"},\"Sleipnir\",\"SlimBrowser\",{label:\"SRWare Iron\",pattern:\"Iron\"},\"Sunrise\",\"Swiftfox\",\"Waterfox\",\"WebPositive\",\"Opera Mini\",{label:\"Opera Mini\",pattern:\"OPiOS\"},\"Opera\",{label:\"Opera\",pattern:\"OPR\"},\"Chrome\",{label:\"Chrome Mobile\",pattern:\"(?:CriOS|CrMo)\"},{label:\"Firefox\",pattern:\"(?:Firefox|Minefield)\"},{label:\"Firefox for iOS\",pattern:\"FxiOS\"},{label:\"IE\",pattern:\"IEMobile\"},{label:\"IE\",pattern:\"MSIE\"},\"Safari\"],function(e,n){return e||RegExp(\"\\\\b\"+(n.pattern||m(n))+\"\\\\b\",\"i\").exec(t)&&(n.label||n)}),G=W([{label:\"BlackBerry\",pattern:\"BB10\"},\"BlackBerry\",{label:\"Galaxy S\",pattern:\"GT-I9000\"},{label:\"Galaxy S2\",pattern:\"GT-I9100\"},{label:\"Galaxy S3\",pattern:\"GT-I9300\"},{label:\"Galaxy S4\",pattern:\"GT-I9500\"},{label:\"Galaxy S5\",pattern:\"SM-G900\"},{label:\"Galaxy S6\",pattern:\"SM-G920\"},{label:\"Galaxy S6 Edge\",pattern:\"SM-G925\"},{label:\"Galaxy S7\",pattern:\"SM-G930\"},{label:\"Galaxy S7 Edge\",pattern:\"SM-G935\"},\"Google TV\",\"Lumia\",\"iPad\",\"iPod\",\"iPhone\",\"Kindle\",{label:\"Kindle Fire\",pattern:\"(?:Cloud9|Silk-Accelerated)\"},\"Nexus\",\"Nook\",\"PlayBook\",\"PlayStation Vita\",\"PlayStation\",\"TouchPad\",\"Transformer\",{label:\"Wii U\",pattern:\"WiiU\"},\"Wii\",\"Xbox One\",{label:\"Xbox 360\",pattern:\"Xbox\"},\"Xoom\"]),V=v({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,\"Kindle Fire\":1},Asus:{Transformer:1},\"Barnes & Noble\":{Nook:1},BlackBerry:{PlayBook:1},Google:{\"Google TV\":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,\"Xbox One\":1},Motorola:{Xoom:1},Nintendo:{\"Wii U\":1,Wii:1},Nokia:{Lumia:1},Samsung:{\"Galaxy S\":1,\"Galaxy S2\":1,\"Galaxy S3\":1,\"Galaxy S4\":1},Sony:{PlayStation:1,\"PlayStation Vita\":1}},function(e,n,r){return e||(n[G]||n[/^[a-z]+(?: +[a-z]+\\b)*/i.exec(G)]||RegExp(\"\\\\b\"+m(r)+\"(?:\\\\b|\\\\w*\\\\d)\",\"i\").exec(t))&&r}),U=v([\"Windows Phone\",\"Android\",\"CentOS\",{label:\"Chrome OS\",pattern:\"CrOS\"},\"Debian\",\"Fedora\",\"FreeBSD\",\"Gentoo\",\"Haiku\",\"Kubuntu\",\"Linux Mint\",\"OpenBSD\",\"Red Hat\",\"SuSE\",\"Ubuntu\",\"Xubuntu\",\"Cygwin\",\"Symbian OS\",\"hpwOS\",\"webOS \",\"webOS\",\"Tablet OS\",\"Tizen\",\"Linux\",\"Mac OS X\",\"Macintosh\",\"Mac\",\"Windows 98;\",\"Windows \"],function(e,n){var r=n.pattern||m(n);return!e&&(e=RegExp(\"\\\\b\"+r+\"(?:/[\\\\d.]+|[ \\\\w.]*)\",\"i\").exec(t))&&(e=function(e,t,n){var r={\"10.0\":\"10\",6.4:\"10 Technical Preview\",6.3:\"8.1\",6.2:\"8\",6.1:\"Server 2008 R2 / 7\",\"6.0\":\"Server 2008 / Vista\",5.2:\"Server 2003 / XP 64-bit\",5.1:\"XP\",5.01:\"2000 SP1\",\"5.0\":\"2000\",\"4.0\":\"NT\",\"4.90\":\"ME\"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\\d.]+$/.exec(e)])&&(e=\"Windows \"+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,\"i\"),n)),u(e.replace(/ ce$/i,\" CE\").replace(/\\bhpw/i,\"web\").replace(/\\bMacintosh\\b/,\"Mac OS\").replace(/_PowerPC\\b/i,\" OS\").replace(/\\b(OS X) [^ \\d]+/i,\"$1\").replace(/\\bMac (OS X)\\b/,\"$1\").replace(/\\/(\\d)/,\" $1\").replace(/_/g,\".\").replace(/(?: BePC|[ .]*fc[ \\d.]+)$/i,\"\").replace(/\\bx86\\.64\\b/gi,\"x86_64\").replace(/\\b(Windows Phone) OS\\b/,\"$1\").replace(/\\b(Chrome OS \\w+) [\\d.]+\\b/,\"$1\").split(\" on \")[0])}(e,r,n.label||n)),e});function W(e){return v(e,function(e,n){var r=n.pattern||m(n);return!e&&(e=RegExp(\"\\\\b\"+r+\" *\\\\d+[.\\\\w_]*\",\"i\").exec(t)||RegExp(\"\\\\b\"+r+\" *\\\\w+-[\\\\w]*\",\"i\").exec(t)||RegExp(\"\\\\b\"+r+\"(?:; *(?:[a-z]+[_-])?[a-z]+\\\\d+|[^ ();-]*)\",\"i\").exec(t))&&((e=String(n.label&&!RegExp(r,\"i\").test(n.label)?n.label:e).split(\"/\"))[1]&&!/[\\d.]+/.test(e[0])&&(e[0]+=\" \"+e[1]),n=n.label||n,e=u(e[0].replace(RegExp(r,\"i\"),n).replace(RegExp(\"; *(?:\"+n+\"[_-])?\",\"i\"),\" \").replace(RegExp(\"(\"+n+\")[-_.]?(\\\\w)\",\"i\"),\"$1 $2\"))),e})}if(N&&(N=[N]),V&&!G&&(G=W([V])),(c=/\\bGoogle TV\\b/.exec(G))&&(G=c[0]),/\\bSimulator\\b/i.test(t)&&(G=(G?G+\" \":\"\")+\"Simulator\"),\"Opera Mini\"==F&&/\\bOPiOS\\b/.test(t)&&D.push(\"running in Turbo/Uncompressed mode\"),\"IE\"==F&&/\\blike iPhone OS\\b/.test(t)?(V=(c=e(t.replace(/like iPhone OS/,\"\"))).manufacturer,G=c.product):/^iP/.test(G)?(F||(F=\"Safari\"),U=\"iOS\"+((c=/ OS ([\\d_]+)/i.exec(t))?\" \"+c[1].replace(/_/g,\".\"):\"\")):\"Konqueror\"!=F||/buntu/i.test(U)?V&&\"Google\"!=V&&(/Chrome/.test(F)&&!/\\bMobile Safari\\b/i.test(t)||/\\bVita\\b/.test(G))||/\\bAndroid\\b/.test(U)&&/^Chrome/.test(F)&&/\\bVersion\\//i.test(t)?(F=\"Android Browser\",U=/\\bAndroid\\b/.test(U)?U:\"Android\"):\"Silk\"==F?(/\\bMobi/i.test(t)||(U=\"Android\",D.unshift(\"desktop mode\")),/Accelerated *= *true/i.test(t)&&D.unshift(\"accelerated\")):\"PaleMoon\"==F&&(c=/\\bFirefox\\/([\\d.]+)\\b/.exec(t))?D.push(\"identifying as Firefox \"+c[1]):\"Firefox\"==F&&(c=/\\b(Mobile|Tablet|TV)\\b/i.exec(t))?(U||(U=\"Firefox OS\"),G||(G=c[1])):!F||(c=!/\\bMinefield\\b/i.test(t)&&/\\b(?:Firefox|Safari)\\b/.exec(F))?(F&&!G&&/[\\/,]|^[^(]+?\\)/.test(t.slice(t.indexOf(c+\"/\")+8))&&(F=null),(c=G||V||U)&&(G||V||/\\b(?:Android|Symbian OS|Tablet OS|webOS)\\b/.test(U))&&(F=/[a-z]+(?: Hat)?/i.exec(/\\bAndroid\\b/.test(U)?U:c)+\" Browser\")):\"Electron\"==F&&(c=(/\\bChrome\\/([\\d.]+)\\b/.exec(t)||0)[1])&&D.push(\"Chromium \"+c):U=\"Kubuntu\",A||(A=v([\"(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\\\d.]+$))\",\"Version\",m(F),\"(?:Firefox|Minefield|NetFront)\"],function(e,n){return e||(RegExp(n+\"(?:-[\\\\d.]+/|(?: for [\\\\w-]+)?[ /-])([\\\\d.]+[^ ();/_-]*)\",\"i\").exec(t)||0)[1]||null})),(c=(\"iCab\"==N&&parseFloat(A)>3?\"WebKit\":/\\bOpera\\b/.test(F)&&(/\\bOPR\\b/.test(t)?\"Blink\":\"Presto\"))||/\\b(?:Midori|Nook|Safari)\\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(N)&&\"WebKit\"||!N&&/\\bMSIE\\b/i.test(t)&&(\"Mac OS\"==U?\"Tasman\":\"Trident\")||\"WebKit\"==N&&/\\bPlayStation\\b(?! Vita\\b)/i.test(F)&&\"NetFront\")&&(N=[c]),\"IE\"==F&&(c=(/; *(?:XBLWP|ZuneWP)(\\d+)/i.exec(t)||0)[1])?(F+=\" Mobile\",U=\"Windows Phone \"+(/\\+$/.test(c)?c:c+\".x\"),D.unshift(\"desktop mode\")):/\\bWPDesktop\\b/i.test(t)?(F=\"IE Mobile\",U=\"Windows Phone 8.x\",D.unshift(\"desktop mode\"),A||(A=(/\\brv:([\\d.]+)/.exec(t)||0)[1])):\"IE\"!=F&&\"Trident\"==N&&(c=/\\brv:([\\d.]+)/.exec(t))&&(F&&D.push(\"identifying as \"+F+(A?\" \"+A:\"\")),F=\"IE\",A=c[1]),j){if(y=\"global\",C=null!=(l=r)?typeof l[y]:\"number\",/^(?:boolean|number|string|undefined)$/.test(C)||\"object\"==C&&!l[y])f(c=r.runtime)==b?(F=\"Adobe AIR\",U=c.flash.system.Capabilities.os):f(c=r.phantom)==R?(F=\"PhantomJS\",A=(c=c.version||null)&&c.major+\".\"+c.minor+\".\"+c.patch):\"number\"==typeof _.documentMode&&(c=/\\bTrident\\/(\\d+)/i.exec(t))?(A=[A,_.documentMode],(c=+c[1]+4)!=A[1]&&(D.push(\"IE \"+A[1]+\" mode\"),N&&(N[1]=\"\"),A[1]=c),A=\"IE\"==F?String(A[1].toFixed(1)):A[0]):\"number\"==typeof _.documentMode&&/^(?:Chrome|Firefox)\\b/.test(F)&&(D.push(\"masking as \"+F+\" \"+A),F=\"IE\",A=\"11.0\",N=[\"Trident\"],U=\"Windows\");else if(w&&(I=(c=w.lang.System).getProperty(\"os.arch\"),U=U||c.getProperty(\"os.name\")+\" \"+c.getProperty(\"os.version\")),E){try{A=r.require(\"ringo/engine\").version.join(\".\"),F=\"RingoJS\"}catch(e){(c=r.system)&&c.global.system==r.system&&(F=\"Narwhal\",U||(U=c[0].os||null))}F||(F=\"Rhino\")}else\"object\"==typeof r.process&&!r.process.browser&&(c=r.process)&&(\"object\"==typeof c.versions&&(\"string\"==typeof c.versions.electron?(D.push(\"Node \"+c.versions.node),F=\"Electron\",A=c.versions.electron):\"string\"==typeof c.versions.nw&&(D.push(\"Chromium \"+A,\"Node \"+c.versions.node),F=\"NW.js\",A=c.versions.nw)),F||(F=\"Node.js\",I=c.arch,U=c.platform,A=(A=/[\\d.]+/.exec(c.version))?A[0]:null));U=U&&u(U)}if(A&&(c=/(?:[ab]|dp|pre|[ab]\\d+pre)(?:\\d+\\+?)?$/i.exec(A)||/(?:alpha|beta)(?: ?\\d)?/i.exec(t+\";\"+(j&&o.appMinorVersion))||/\\bMinefield\\b/i.test(t)&&\"a\")&&(L=/b/i.test(c)?\"beta\":\"alpha\",A=A.replace(RegExp(c+\"\\\\+?$\"),\"\")+(\"beta\"==L?k:P)+(/\\d+\\+?/.exec(c)||\"\")),\"Fennec\"==F||\"Firefox\"==F&&/\\b(?:Android|Firefox OS)\\b/.test(U))F=\"Firefox Mobile\";else if(\"Maxthon\"==F&&A)A=A.replace(/\\.[\\d.]+/,\".x\");else if(/\\bXbox\\b/i.test(G))\"Xbox 360\"==G&&(U=null),\"Xbox 360\"==G&&/\\bIEMobile\\b/.test(t)&&D.unshift(\"mobile mode\");else if(!/^(?:Chrome|IE|Opera)$/.test(F)&&(!F||G||/Browser|Mobi/.test(F))||\"Windows CE\"!=U&&!/Mobi/i.test(t))if(\"IE\"==F&&j)try{null===r.external&&D.unshift(\"platform preview\")}catch(e){D.unshift(\"embedded\")}else(/\\bBlackBerry\\b/.test(G)||/\\bBB10\\b/.test(t))&&(c=(RegExp(G.replace(/ +/g,\" *\")+\"/([.\\\\d]+)\",\"i\").exec(t)||0)[1]||A)?(U=((c=[c,/BB10/.test(t)])[1]?(G=null,V=\"BlackBerry\"):\"Device Software\")+\" \"+c[0],A=null):this!=h&&\"Wii\"!=G&&(j&&M||/Opera/.test(F)&&/\\b(?:MSIE|Firefox)\\b/i.test(t)||\"Firefox\"==F&&/\\bOS X (?:\\d+\\.){2,}/.test(U)||\"IE\"==F&&(U&&!/^Win/.test(U)&&A>5.5||/\\bWindows XP\\b/.test(U)&&A>8||8==A&&!/\\bTrident\\b/.test(t)))&&!s.test(c=e.call(h,t.replace(s,\"\")+\";\"))&&c.name&&(c=\"ing as \"+c.name+((c=c.version)?\" \"+c:\"\"),s.test(F)?(/\\bIE\\b/.test(c)&&\"Mac OS\"==U&&(U=null),c=\"identify\"+c):(c=\"mask\"+c,F=O?u(O.replace(/([a-z])([A-Z])/g,\"$1 $2\")):\"Opera\",/\\bIE\\b/.test(c)&&(U=null),j||(A=null)),N=[\"Presto\"],D.push(c));else F+=\" Mobile\";(c=(/\\bAppleWebKit\\/([\\d.]+\\+?)/i.exec(t)||0)[1])&&(c=[parseFloat(c.replace(/\\.(\\d)$/,\".0$1\")),c],\"Safari\"==F&&\"+\"==c[1].slice(-1)?(F=\"WebKit Nightly\",L=\"alpha\",A=c[1].slice(0,-1)):A!=c[1]&&A!=(c[2]=(/\\bSafari\\/([\\d.]+\\+?)/i.exec(t)||0)[1])||(A=null),c[1]=(/\\bChrome\\/([\\d.]+)/i.exec(t)||0)[1],537.36==c[0]&&537.36==c[2]&&parseFloat(c[1])>=28&&\"WebKit\"==N&&(N=[\"Blink\"]),j&&(S||c[1])?(N&&(N[1]=\"like Chrome\"),c=c[1]||((c=c[0])<530?1:c<532?2:c<532.05?3:c<533?4:c<534.03?5:c<534.07?6:c<534.1?7:c<534.13?8:c<534.16?9:c<534.24?10:c<534.3?11:c<535.01?12:c<535.02?\"13+\":c<535.07?15:c<535.11?16:c<535.19?17:c<536.05?18:c<536.1?19:c<537.01?20:c<537.11?\"21+\":c<537.13?23:c<537.18?24:c<537.24?25:c<537.36?26:\"Blink\"!=N?\"27\":\"28\")):(N&&(N[1]=\"like Safari\"),c=(c=c[0])<400?1:c<500?2:c<526?3:c<533?4:c<534?\"4+\":c<535?5:c<537?6:c<538?7:c<601?8:\"8\"),N&&(N[1]+=\" \"+(c+=\"number\"==typeof c?\".x\":/[.+]/.test(c)?\"\":\"+\")),\"Safari\"==F&&(!A||parseInt(A)>45)&&(A=c)),\"Opera\"==F&&(c=/\\bzbov|zvav$/.exec(U))?(F+=\" \",D.unshift(\"desktop mode\"),\"zvav\"==c?(F+=\"Mini\",A=null):F+=\"Mobile\",U=U.replace(RegExp(\" *\"+c+\"$\"),\"\")):\"Safari\"==F&&/\\bChrome\\b/.exec(N&&N[1])&&(D.unshift(\"desktop mode\"),F=\"Chrome Mobile\",A=null,/\\bOS X\\b/.test(U)?(V=\"Apple\",U=\"iOS 4.3+\"):U=null),A&&0==A.indexOf(c=/[\\d.]+$/.exec(U))&&t.indexOf(\"/\"+c+\"-\")>-1&&(U=g(U.replace(c,\"\"))),N&&!/\\b(?:Avant|Nook)\\b/.test(F)&&(/Browser|Lunascape|Maxthon/.test(F)||\"Safari\"!=F&&/^iOS/.test(U)&&/\\bSafari\\b/.test(N[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(F)&&N[1])&&(c=N[N.length-1])&&D.push(c),D.length&&(D=[\"(\"+D.join(\"; \")+\")\"]),V&&G&&G.indexOf(V)<0&&D.push(\"on \"+V),G&&D.push((/^on /.test(D[D.length-1])?\"\":\"on \")+G),U&&(c=/ ([\\d.+]+)$/.exec(U),d=c&&\"/\"==U.charAt(U.length-c[0].length-1),U={architecture:32,family:c&&!d?U.replace(c[0],\"\"):U,version:c?c[1]:null,toString:function(){var e=this.version;return this.family+(e&&!d?\" \"+e:\"\")+(64==this.architecture?\" 64-bit\":\"\")}}),(c=/\\b(?:AMD|IA|Win|WOW|x86_|x)64\\b/i.exec(I))&&!/\\bi686\\b/i.test(I)?(U&&(U.architecture=64,U.family=U.family.replace(RegExp(\" *\"+c),\"\")),F&&(/\\bWOW64\\b/i.test(t)||j&&/\\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\\bWin64; x64\\b/i.test(t))&&D.unshift(\"32-bit\")):U&&/^OS X/.test(U.family)&&\"Chrome\"==F&&parseFloat(A)>=39&&(U.architecture=64),t||(t=null);var B={};return B.description=t,B.layout=N&&N[0],B.manufacturer=V,B.name=F,B.prerelease=L,B.product=G,B.ua=t,B.version=F&&A,B.os=U||{architecture:null,family:null,version:null,toString:function(){return\"null\"}},B.parse=e,B.toString=function(){return this.description||\"\"},B.version&&D.unshift(A),B.name&&D.unshift(F),U&&F&&(U!=String(U).split(\" \")[0]||U!=F.split(\" \")[0]&&!G)&&D.push(G?\"(\"+U+\")\":\"on \"+U),D.length&&(B.description=D.join(\" \")),B}();r&&i?h(y,function(e,t){r[t]=e}):n.platform=y}).call(se)}),le=ce(function(e,t){e.exports=function(){var e=function(e){return function(e){return!!e&&\"object\"==typeof e}(e)&&!function(e){var n=Object.prototype.toString.call(e);return\"[object RegExp]\"===n||\"[object Date]\"===n||function(e){return e.$$typeof===t}(e)}(e)},t=\"function\"==typeof Symbol&&Symbol.for?Symbol.for(\"react.element\"):60103;function n(e,t){return!1!==t.clone&&t.isMergeableObject(e)?o((n=e,Array.isArray(n)?[]:{}),e,t):e;var n}function r(e,t,r){return e.concat(t).map(function(e){return n(e,r)})}function i(e,t,r){var i={};return r.isMergeableObject(e)&&Object.keys(e).forEach(function(t){i[t]=n(e[t],r)}),Object.keys(t).forEach(function(a){r.isMergeableObject(t[a])&&e[a]?i[a]=function(e,t){if(!t.customMerge)return o;var n=t.customMerge(e);return\"function\"==typeof n?n:o}(a,r)(e[a],t[a],r):i[a]=n(t[a],r)}),i}function o(t,o,a){(a=a||{}).arrayMerge=a.arrayMerge||r,a.isMergeableObject=a.isMergeableObject||e;var s=Array.isArray(o);return s===Array.isArray(t)?s?a.arrayMerge(t,o,a):i(t,o,a):n(o,a)}return o.all=function(e,t){if(!Array.isArray(e))throw new Error(\"first argument should be an array\");return e.reduce(function(e,n){return o(e,n,t)},{})},o}()}),ue=\"object\"==typeof Reflect?Reflect:null,he=ue&&\"function\"==typeof ue.apply?ue.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};de=ue&&\"function\"==typeof ue.ownKeys?ue.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var fe=Number.isNaN||function(e){return e!=e};function me(){me.init.call(this)}var ve=me;me.EventEmitter=me,me.prototype._events=void 0,me.prototype._eventsCount=0,me.prototype._maxListeners=void 0;var ge=10;function ye(e){return void 0===e._maxListeners?me.defaultMaxListeners:e._maxListeners}function Ce(e,t,n,r){var i,o,a,s;if(\"function\"!=typeof n)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof n);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit(\"newListener\",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if(\"function\"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=ye(e))>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error(\"Possible EventEmitter memory leak detected. \"+a.length+\" \"+String(t)+\" listeners added. Use emitter.setMaxListeners() to increase limit\");c.name=\"MaxListenersExceededWarning\",c.emitter=e,c.type=t,c.count=a.length,s=c,console&&console.warn&&console.warn(s)}return e}function Se(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,he(this.listener,this.target,e))}.bind(r);return i.listener=n,r.wrapFn=i,i}function be(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:\"function\"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):xe(i,i.length)}function Te(e){var t=this._events;if(void 0!==t){var n=t[e];if(\"function\"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function xe(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(me,\"defaultMaxListeners\",{enumerable:!0,get:function(){return ge},set:function(e){if(\"number\"!=typeof e||e<0||fe(e))throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received '+e+\".\");ge=e}}),me.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},me.prototype.setMaxListeners=function(e){if(\"number\"!=typeof e||e<0||fe(e))throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received '+e+\".\");return this._maxListeners=e,this},me.prototype.getMaxListeners=function(){return ye(this)},me.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r=\"error\"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error(\"Unhandled error.\"+(o?\" (\"+o.message+\")\":\"\"));throw a.context=o,a}var s=i[e];if(void 0===s)return!1;if(\"function\"==typeof s)he(s,this,t);else{var c=s.length,d=xe(s,c);for(n=0;n<c;++n)he(d[n],this,t)}return!0},me.prototype.addListener=function(e,t){return Ce(this,e,t,!1)},me.prototype.on=me.prototype.addListener,me.prototype.prependListener=function(e,t){return Ce(this,e,t,!0)},me.prototype.once=function(e,t){if(\"function\"!=typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);return this.on(e,Se(this,e,t)),this},me.prototype.prependOnceListener=function(e,t){if(\"function\"!=typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,Se(this,e,t)),this},me.prototype.removeListener=function(e,t){var n,r,i,o,a;if(\"function\"!=typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit(\"removeListener\",e,n.listener||t));else if(\"function\"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit(\"removeListener\",e,a||t)}return this},me.prototype.off=me.prototype.removeListener,me.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)\"removeListener\"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners(\"removeListener\"),this._events=Object.create(null),this._eventsCount=0,this}if(\"function\"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},me.prototype.listeners=function(e){return be(this,e,!0)},me.prototype.rawListeners=function(e){return be(this,e,!1)},me.listenerCount=function(e,t){return\"function\"==typeof e.listenerCount?e.listenerCount(t):Te.call(e,t)},me.prototype.listenerCount=Te,me.prototype.eventNames=function(){return this._eventsCount>0?de(this._events):[]};class Re{constructor(){this.token,this.serviceId,this.config,this.version,this.channel={id:void 0,name:void 0,peers:[],startTime:void 0,status:void 0,type:void 0,members:[]},this.localVideo,this.remoteMedia,this.remoteMedia2,this.localStream,this.remoteStream,this.transceivers=null,this.devices={currentVideoInput:-1,currentAudioInput:-1,videoInput:[],audioInput:[],audioOutput:[]},this.peerConnection,this.dataConnection,this.state,this.isConnectToSig=!1,this.elive,this.callEvent,this.eventManager,this.mediaManager,this.signaler,this.messaging,this.country=void 0,this.purpose=\"P2P\",this.startTime=0,this.endTime=0,this.health=void 0}}const we=(()=>{let e,t,n;function r(...t){\"SILENT\"!==e&&\"ERROR\"!==e&&\"WARN\"!==e&&console.info(...t)}return Object.freeze({init:function(r){e=(t=r).config.sdk.logLevel,n=t.config.sdk.url.log},e:function(...t){\"SILENT\"!==e&&console.error(...t)},w:function(...t){\"SILENT\"!==e&&\"ERROR\"!==e&&console.warn(...t)},l:function(...e){r(...e)},i:r,d:function(...t){\"SILENT\"!==e&&\"ERROR\"!==e&&\"WARN\"!==e&&\"INFO\"!==e&&console.debug(...t)},v:function(...t){\"SILENT\"!==e&&\"ERROR\"!==e&&\"WARN\"!==e&&\"INFO\"!==e&&\"DEBUG\"!==e&&console.trace(...t)},t:function(e,t){\"CALLER\"!==e.role&&\"CASTOR\"!==e.role&&fetch(e.config.sdk.url.channelLog,{method:\"POST\",body:JSON.stringify(t),headers:{\"Content-Type\":\"application/json\"}}).catch(e=>{console.error(e)})},evt:function(e,n){const r={topic:\"log\",messages:{log:e,logLevel:n?\"error\":\"info\",sdkVersion:t.version,svcId:t.serviceId,pId:t.token,chId:t.channel.id,errorCode:n||\"2000\"}};fetch(t.config.sdk.url.log,{method:\"PUT\",mode:\"cors\",headers:{\"Content-Type\":\"application/json; charset=utf-8\",\"Access-Control-Allow-Origin\":\"*\"},body:JSON.stringify(r)})}})})();class Ee extends Error{constructor(e,t){super(e.text),this.name=\"ELiveError\",this.code=e.code,this.text=e.text,t&&console.error(t)}}class Pe{constructor(e){this.ctx=e,this.pc=new RTCPeerConnection(e.config.rtc),this.ctx.dataConnection=this.pc,this.channel}startAnswer(e){we.i(\"start answer for dc\"),this.pc.setRemoteDescription(e).then(()=>{we.d(\"remote description(offer) for dc is set\")}).catch(e=>{throw console.error(e),new Ee({code:\"1300\",text:\"remote description for dc is wrong\"})}),\"offer\"===e.type&&this.pc.createAnswer().then(e=>{this.pc.setLocalDescription(e).then(()=>{we.d(\"local description(answer) for dc is set\");const t=this.ctx.signaler.createMessage({command:\"sdp\",body:JSON.stringify(e)});t.to=this.ctx.peerConnection.to,t.pctype=\"DC\",this.ctx.signaler.send(t)})}).catch(e=>{throw new Ee({code:\"1300\",text:\"failed to create answer for dc\"},e)})}close(){we.d(\"datachannel is close\"),this.pc.close(),this.ctx.dataConnection=null,this.channel=null}setRemoteDesciption(e){this.pc.setRemoteDescription(e).then(()=>{we.i(\"remote description(answer) is set\")}).catch(e=>{throw console.error(e),new Ee({code:\"1300\",text:\"remote description(answer) is wrong\"})})}startOffer(){we.d(\"startOffer is started\"),this.channel=this.pc.createDataChannel(\"chat\"),this.channel.onopen=(e=>we.d(\"datachannel is connected\")),this.channel.onmessage=(e=>this.ctx.callEvent({name:\"onMessage\",param:e.data})),this.pc.createOffer().then(e=>{this.pc.setLocalDescription(e).then(()=>{we.d(\"local description for dc is set\");const t=this.ctx.signaler.createMessage({command:\"sdp\",body:JSON.stringify(e)});t.to=this.ctx.channel.master,t.pctype=\"DC\",we.v(t),this.ctx.signaler.send(t)})})}listening(){we.d(\"listening is started\"),this.pc.ondatachannel=(e=>{this.channel=e.channel,console.log(this.channel),this.channel.onopen=(e=>we.d(\"datachannel is connected\")),this.channel.onmessage=(e=>this.ctx.callEvent({name:\"onMessage\",param:e.data}))})}sendMessage(e){we.d(`sendMessage: ${e}`),this.channel&&this.channel.send(e)}}const ke=(()=>Object.freeze({validateConfig:function(e){e.config.credential&&e.config.credential.serviceId&&e.config.credential.key||(e.config.credential={serviceId:\"SERVICEID1\",key:\"1234567890\"})},validateDevices:async function(e){we.d(\"start gathering available devices\");var t=-1,n=-1;e.config.media.video&&e.config.media.video.deviceId&&(t=e.config.media.video.deviceId),e.config.media.audio&&e.config.media.audio.deviceId&&(n=e.config.media.audio.deviceId),await navigator.mediaDevices.enumerateDevices().then(r=>{for(var i=0;i<r.length;i++){const a=r[i];if(\"videoinput\"===a.kind){var o=e.devices.videoInput.push({text:a.label,id:a.deviceId});a.deviceId===t&&(e.devices.currentVideoInput=o-1)}else\"audioinput\"===a.kind?(o=e.devices.audioInput.push({text:a.label,id:a.deviceId}),a.deviceId===n&&(e.devices.currentAudioInput=o-1)):\"audiooutput\"===a.kind&&e.devices.audioOutput.push({text:a.label,id:a.deviceId})}}),-1===e.devices.currentVideoInput&&e.devices.videoInput.length>0&&(e.devices.currentVideoInput=0),-1===e.devices.currentAudioInput&&e.devices.audioInput.length>0&&(e.devices.currentAudioInput=0),we.v(e.devices),we.d(\"finish gathering available devices\")},getMusicConfiguration:function(){return{mandatory:{googHighpassFilter:!1,googEchoCancellation:!1,googEchoCancellation2:!1,googAutoGainControl:!1,googAutoGainControl2:!1,googNoiseSuppression:!1,googNoiseSuppression2:!1,googTypingNoiseDetection:!1,echoCancellation:!1},optional:[{googCpuOveruseDetection:!1}]}},makeTransactionLog:function(e){return{pid:e.token,svcid:e.config.credential.serviceId,cid:e.channel.id,type:e.channel.type,start_time:e.startTime,duration:Math.round((e.endTime-e.startTime)/1e3),network:\"wifi\",status:e.state}}}))();class _e extends ve{constructor(e){super(),this.ctx=e,this.onMessageHandler=null,this.ws,this.MAX_RETRIES=11}init(){we.d(\"start signaler init\"),this.ctx.isConnectToSig=!1,this.ctx.sigMsgHandler=function(e){const t={onCall(t){we.i(`start onCall with chid:${t.channel.id}`),t.pctype&&\"DC\"===t.pctype||(e.channel=t.channel),e.role=\"CALLER\",e.callEvent({name:\"onCall\",param:{channel:e.channel}}),e.peerConnection=new RTCPeerConnection(e.config.rtc,e.config.rtc.opt),e.peerConnection.onicecandidate=i,e.localStream.getTracks().forEach(t=>e.peerConnection.addTrack(t,e.localStream)),e.peerConnection.ontrack=d,e.messaging=new Pe(e),e.messaging.listening(),e.dataConnection.onicecandidate=o,e.peerConnection.oniceconnectionstatechange=s},onCallee(t){we.i(`start onCallee with chid:${t.channel.id}`),t.pctype&&\"DC\"===t.pctype||(e.channel=t.channel),e.role=\"CALLEE\",e.callEvent({name:\"onCall\",param:{channel:e.channel}}),e.peerConnection=new RTCPeerConnection(e.config.rtc,e.config.rtc.opt),e.peerConnection.onicecandidate=i,e.localStream.getTracks().forEach(t=>e.peerConnection.addTrack(t,e.localStream)),e.peerConnection.ontrack=d,e.peerConnection.oniceconnectionstatechange=s,e.peerConnection.to=e.channel.master,e.peerConnection.onnegotiationneeded=c,e.messaging=new Pe(e),e.messaging.startOffer(),e.dataConnection.onicecandidate=o,e.peerConnection.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then(t=>{t.sdp=r(t.sdp,/m=video(:?.*)?/,\"H264\"),t.sdp=t.sdp.replace(\"a=fmtp:111 minptime=10;useinbandfec=1\",\"a=fmtp:111 useinbandfec=1;minptime=10;stereo=1;cbr=1;maxaveragebitrate=400000\"),e.config.media.video.bitrate&&(t.sdp=n(t.sdp,\"video\",e.config.media.video.bitrate)),e.peerConnection.setLocalDescription(t).then(()=>{we.d(\"local description setted\");const n=e.signaler.createMessage({command:\"sdp\",body:JSON.stringify(t)});n.to=e.channel.master,we.d(`local offer msg: ${JSON.stringify(n)}`),e.signaler.send(n)})})},onCast(t){t.status>3099?e.callEvent({name:\"error\",param:new Ee({code:t.status,text:t.desc})}):(we.i(`start onCast with chid: ${t.channel.id}`),e.channel=t.channel,e.callEvent({name:\"onCast\",param:{channel:e.channel}}),e.role=\"CASTOR\",e.peerConnection=new RTCPeerConnection(e.config.rtc,e.config.rtc.opt),e.peerConnection.onicecandidate=i,e.localStream.getTracks().forEach(t=>e.peerConnection.addTransceiver(t,{direction:\"sendonly\",streams:[e.localStream]})),e.peerConnection.ontrack=d,e.peerConnection.oniceconnectionstatechange=s,e.peerConnection.to=e.channel.members[0].id,e.peerConnection.onnegotiationneeded=c,e.peerConnection.createOffer({offerToReceiveAudio:0,offerToReceiveVideo:0,voiceActivityDetection:!1}).then(t=>{t.sdp=r(t.sdp,/m=video(:?.*)?/,\"H264\"),e.config.media.video.bitrate&&(t.sdp=n(t.sdp,\"video\",e.config.media.video.bitrate)),t.sdp=t.sdp.replace(\"a=fmtp:111 minptime=10;useinbandfec=1\",\"a=fmtp:111 useinbandfec=1;minptime=10;stereo=1;cbr=1;maxaveragebitrate=128000\"),we.d(`local offer: ${JSON.stringify(t)}`),e.peerConnection.setLocalDescription(t).then(()=>{we.d(\"local description setted\");const n=e.signaler.createMessage({command:\"sdp\",body:JSON.stringify(t)});n.to=e.channel.members[0].id,e.signaler.send(n)})}),e.health.start())},onWatch(t){we.i(`start onWatch with chid: ${t.channel.id}`),e.channel=t.channel,e.callEvent({name:\"onWatch\",param:{channel:e.channel}}),e.role=\"VIEWER\",e.peerConnection=new RTCPeerConnection(e.config.rtc,e.config.rtc.opt),e.peerConnection.onicecandidate=i,e.peerConnection.ontrack=d,e.peerConnection.oniceconnectionstatechange=a,e.peerConnection.to=e.channel.members[0].id,e.peerConnection.onnegotiationneeded=c},onSearch(t){if(we.d(`onSearch ${JSON.stringify(t.body)}`),t.body){var n=new Set;t.body.forEach(e=>{n.add(e.id)}),t.body=[...n],e.callEvent({name:\"onSearch\",param:t.body})}},pong(e){},async onSdp(t){we.d(`onSdp: ${t.body}`);const n=new RTCSessionDescription(JSON.parse(t.body));e.peerConnection.to=t.from,\"DC\"!==t.pctype?(e.peerConnection.setRemoteDescription(n).then(()=>{we.i(\"remote description is set\")}).catch(e=>{throw new Ee({code:\"1300\",text:\"remote description is wrong\"})}),\"offer\"===n.type&&e.peerConnection.createAnswer().then(t=>{t.sdp=t.sdp.replace(\"a=fmtp:111 \",\"a=fmtp:111 useinbandfec=1;minptime=10;stereo=1;cbr=1;maxaveragebitrate=128000\"),e.peerConnection.setLocalDescription(t).then(()=>{we.d(\"local description is set\");const n=e.signaler.createMessage({command:\"sdp\",body:JSON.stringify(t)});n.to=e.peerConnection.to,e.signaler.send(n)})}).catch(e=>{throw new Ee({code:\"1300\",text:\"failed to create answer\"},e)})):\"offer\"===n.type?e.messaging.startAnswer(n):e.messaging.setRemoteDesciption(n)},async onIce(t){const n=new RTCIceCandidate(JSON.parse(t.body));we.d(\"candidate: \",JSON.stringify(n)),t.pctype&&\"DC\"===t.pctype?e.dataConnection.addIceCandidate(n):e.peerConnection.addIceCandidate(n)}};function n(e,t,n){for(var r=e.split(\"\\n\"),i=-1,o=0;o<r.length;o++)if(0===r[o].indexOf(\"m=\"+t)){i=o;break}if(-1===i)return console.debug(\"Could not find the m line for\",t),e;for(console.debug(\"Found the m line for\",t,\"at line\",i),i++;0===r[i].indexOf(\"i=\")||0===r[i].indexOf(\"c=\");)i++;if(0===r[i].indexOf(\"b\"))return console.debug(\"Replaced b line at line\",i),r[i]=\"b=AS:\"+n,r.join(\"\\n\");console.debug(\"Adding new b line before line\",i);var a=r.slice(0,i);return a.push(\"b=AS:\"+n),(a=a.concat(r.slice(i,r.length))).join(\"\\n\")}function r(e,t,n){var r,i,o,a=[],s=new RegExp(\"a=rtpmap:(\\\\d+) \"+n+\"/\\\\d+\");if(!(r=e.match(t)))return e;if(!(i=e.match(s)))return e;r=r[0],i=i[1],o=r.split(\" \"),a.push(o[0]),a.push(o[1]),a.push(o[2]),a.push(i);for(var c=3;c<o.length;c++)o[c]!==i&&a.push(o[c]);return e.replace(r,a.join(\" \"))}function i(t){console.log(\"ice candidate is created\"),console.log(t.candidate);const n=e.signaler.createMessage({command:\"ice\",body:JSON.stringify(t.candidate)});n.to=e.peerConnection.to,e.signaler.send(n)}function o(t){console.log(\"ice candidate for dc is created\"),console.log(t.candidate);const n=e.signaler.createMessage({command:\"ice\",body:JSON.stringify(t.candidate)});n.to=e.peerConnection.to,n.pctype=\"DC\",e.signaler.send(n)}function a(t){if(e&&\"CLOSE\"!==e.state)if(we.i(`ice con evt: ${e.peerConnection.iceConnectionState}`),\"connected\"===e.peerConnection.iceConnectionState)e.remoteStream.getAudioTracks().length>1?(e.remoteMedia.srcObject=new MediaStream([e.remoteStream.getAudioTracks()[0]]),e.remoteMedia2&&(e.remoteMedia2.srcObject=new MediaStream([e.remoteStream.getAudioTracks()[1]]))):e.remoteMedia.srcObject=e.remoteStream,e.state=\"COMPLETE\",e.startTime=(new Date).getTime(),e.callEvent({name:\"onComplete\",param:{channel:e.channel}});else if(\"closed\"===e.peerConnection.iceConnectionState)\"CLOSE\"!==e.state&&(e.elive.close(),e.endTime=(new Date).getTime(),we.t(e,ke.makeTransactionLog(e)));else{if(\"failed\"===e.peerConnection.iceConnectionState){if(\"CLOSE\"===e.state)return;throw e.state=\"FAIL\",e.endTime=(new Date).getTime(),we.t(e,ke.makeTransactionLog(e)),new Ee({code:\"1300\",text:\"ice connecting is failed\"})}\"disconnected\"===e.peerConnection.iceConnectionState&&(\"CLOSE\"!==e.state&&(e.state=\"CLOSE\",e.endTime=(new Date).getTime(),we.t(e,ke.makeTransactionLog(e))),e.callEvent({name:\"onClose\",param:{}}))}}function s(t){if(e&&\"CLOSE\"!==e.state)switch(we.i(`ice con evt: ${e.peerConnection.iceConnectionState}`),e.peerConnection.iceConnectionState){case\"connected\":\"P2P\"===e.channel.type&&(e.signaler.close(),e.isConnectToSig=!1,e.remoteMedia.srcObject=e.remoteStream),e.state=\"COMPLETE\",e.startTime=(new Date).getTime(),e.transceivers=e.peerConnection.getTransceivers(),e.callEvent({name:\"onComplete\",param:{channel:e.channel}});break;case\"closed\":\"CLOSE\"!==e.state&&(e.elive.close(),e.endTime=(new Date).getTime(),we.t(e,ke.makeTransactionLog(e)));break;case\"failed\":throw e.state=\"FAIL\",e.endTime=(new Date).getTime(),we.t(e,ke.makeTransactionLog(e)),new Ee({code:\"1300\",text:\"ice connecting is failed\"});case\"disconnected\":\"CLOSE\"!==e.state&&(e.endTime=(new Date).getTime(),we.t(e,ke.makeTransactionLog(e)),e.elive.close())}}function c(e){we.w(\"negotiation is needed\")}function d(t){we.d(\"received track\"),console.dir(t),\"track\"===t.type&&(e.remoteStream.addTrack(t.track),e.transceivers=e.peerConnection.getTransceivers())}e.signaler.onMessage(function(e){const n=JSON.parse(e.data),r=n.command;we.d(`-> msg: ${n.command}`,n),t[r](n)})}(this.ctx),this.ws=new WebSocket(this.ctx.config.sdk.url.sig),this.ws.onopen=(()=>{we.i(\"Sig: success connect to sig server\"),this.ctx.isConnectToSig=!0,this.ctx.callEvent({name:\"init\",param:{}})}),this.ws.onerror=(e=>{throw new Ee({code:\"1400\",text:\"websocket is failed\"},e)}),this.ws.onclose=(e=>{we.i(\"websocket is closed\")}),this.ws.onmessage=this.onMessageHandler,we.d(\"finished signaler init\")}onMessage(e){this.onMessageHandler=e}async call(e){await this._sendCommand(\"call\",e,\"P2P\")}async cast(e){await this._sendCommand(\"cast\",e,\"BROADCAST\")}async watch(e){await this._sendCommand(\"watch\",e,\"BROADCAST\")}async search(e){await this.waitForConnection();const t=this.createMessage({command:\"search\"});this.send(t)}async _sendCommand(e,t,n){await this.waitForConnection(),we.i(\"start \"+e),this.ctx.channel.id=t,this.ctx.channel.type=n;const r=this.createMessage({command:e});we.v(r),this.send(r)}send(e){const t=JSON.stringify(e);if(this.ws)try{this.ws.send(t)}catch(e){throw new Ee({code:\"1400\",text:\"send error\"},e)}}close(){we.d(\"signaler is close\"),this.ws.close(),this.ctx.isConnectToSig=!1}createMessage({command:e,body:t}){return{command:e,token:this.ctx.token,serviceId:this.ctx.config.credential.serviceId,channel:this.ctx.channel,body:t}}async waitForConnection(){for(let e=5;e<=this.MAX_RETRIES;e++){if(!0===this.ctx.isConnectToSig)return;{const t=Math.pow(2,e);we.d(\"wating for init %i\",e),await this.wait(t)}}}wait(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}}async function Me(e){we.d(\"start auth with context\");const t={credential:{key:e.config.credential.key,serviceId:e.config.credential.serviceId},env:{os:pe.os.family,osVersion:pe.os.version||\"0\",device:pe.name,deviceVersion:pe.version||\"0\",sdkVersion:e.version,purpose:e.purpose,country:e.config.sdk&&e.config.sdk.country?e.config.sdk.country:\"KR\",mode:e.config.sdk.mode}};e.config.sdk.coachId&&(t.env.coachId=e.config.sdk.coachId);const n={method:\"POST\",headers:{Accept:\"application/json, text/plain, */*\",\"Content-Type\":\"application/json\"},body:JSON.stringify(t)};try{const r=await fetch(e.config.sdk.url.auth,n),i=await r.json();Object.keys(i).forEach(t=>{switch(t){case\"iceServers\":i[t].forEach(t=>e.config.rtc.iceServers.push(t));break;case\"token\":e.token=i[t];break;case\"coach\":e.config.sdk.url.sig=i[t].url;break;case\"channelLogUrl\":e.config.sdk.url.channelLog=i[t]}})}catch(t){throw console.error(t),new Ee({code:1600,text:`Auth is failed with id:${e.config.credential.serviceId}/ key:${e.config.credential.key}`})}if(!e.token)throw new Ee({code:1600,text:`failed to auth with id: ${e.config.credential.serviceId} and key: ${e.config.credential.key}`});we.d(\"success auth\")}var Oe={credential:{serviceId:void 0,key:void 0},view:{local:void 0,remote:void 0,remote2:void 0},rtc:{iceServers:[{urls:\"stun:stun.l.google.com:19302\"}],opt:{},dataOpt:{optional:[{RtpDataChannels:!0}]},sdpSemantics:\"unified-plan\"},media:{video:{frameRate:{min:20,max:30}},audio:{channelCount:2}},sdk:{url:{auth:\"https://auth.remotemonster.com/auth\",log:\"https://signal.remotemonster.com:2001/topics\",channelLog:\"\"},logLevel:\"INFO\",audioType:\"voice\",mode:\"prod\",coachId:void 0,country:void 0}};class Ie{constructor(e){this.ctx=e}async captureScreen(){this.ctx.localStream=await navigator.mediaDevices.getDisplayMedia({video:!0}),this.ctx.transceivers[1].sender.replaceTrack(this.ctx.localStream.getTracks()[0]),this.ctx.localStream.addTrack(this.ctx.transceivers[0].sender.track),this.ctx.localVideo.srcObject=this.ctx.localStream}stopCaptureScreen(){showLocalVideo()}async validateDevices(){we.d(\"start gathering available devices\");var e=-1,t=-1;if(this.ctx.config.media.video&&this.ctx.config.media.video.deviceId&&(e=this.ctx.config.media.video.deviceId),this.ctx.config.media.audio&&this.ctx.config.media.audio.deviceId&&(t=this.ctx.config.media.audio.deviceId),await navigator.mediaDevices.enumerateDevices().then(n=>{for(var r=0;r<n.length;r++){const o=n[r];if(\"videoinput\"===o.kind){var i=this.ctx.devices.videoInput.push({text:o.label,id:o.deviceId});o.deviceId===e&&(this.ctx.devices.currentVideoInput=i-1)}else\"audioinput\"===o.kind?(i=this.ctx.devices.audioInput.push({text:o.label,id:o.deviceId}),o.deviceId===t&&(this.ctx.devices.currentAudioInput=i-1)):\"audiooutput\"===o.kind&&this.ctx.devices.audioOutput.push({text:o.label,id:o.deviceId})}}),0===this.ctx.devices.videoInput.length||0===this.ctx.devices.audioInput.length)throw new Ee({code:\"1500\",text:\"there is no input device\"});-1===this.ctx.devices.currentVideoInput&&this.ctx.devices.videoInput.length>0&&(this.ctx.devices.currentVideoInput=0),-1===this.ctx.devices.currentAudioInput&&this.ctx.devices.audioInput.length>0&&(this.ctx.devices.currentAudioInput=0),document.querySelector(\"#\"+this.ctx.config.view.local)&&(this.ctx.localVideo=document.querySelector(\"#\"+this.ctx.config.view.local)),document.querySelector(\"#\"+this.ctx.config.view.remote)&&(this.ctx.remoteMedia=document.querySelector(\"#\"+this.ctx.config.view.remote)),document.querySelector(\"#\"+this.ctx.config.view.remote2)&&(this.ctx.remoteMedia2=document.querySelector(\"#\"+this.ctx.config.view.remote2)),we.d(\"finish gathering available devices: ${JSON.stringify(this.ctx.devices)}\")}setVideoInput(e){we.d(\"start to set video input with \"+e);const t=this.findDevice(e,this.ctx.devices.videoInput);if(-1==t)throw new Ee({code:\"1500\",text:\"incorrect video device. input a right video device id.\"});this.ctx.devices.currentVideoInput=t,this.ctx.config.media.video.deviceId=this.ctx.devices.videoInput[t].id,we.d(\"finish to set video input with \"+e)}setAudioInput(e){we.d(\"start to set audio input with \"+e);const t=this.findDevice(e,this.ctx.devices.audioInput);if(-1==t)throw new Ee({code:\"1500\",text:\"incorrect audio device. input a right audio device id.\"});this.ctx.devices.currentAudioInput=t,this.ctx.config.media.audio.deviceId=this.ctx.devices.audioInput[t].id,we.d(\"finish to set audio input with \"+e)}async switchCamera(){we.d(\"start to switch camera\"),this.ctx.devices.videoInput.length<2||(++this.ctx.devices.currentVideoInput===this.ctx.devices.videoInput.length&&(this.ctx.devices.currentVideoInput=0),this.showLocalVideo(this.ctx.devices.videoInput[this.ctx.devices.currentVideoInput].id),this.ctx.config.media.video.deviceId={exact:[this.ctx.devices.videoInput[this.ctx.devices.currentVideoInput].id]},we.d(\"finish to switch camera\"))}muteRemote(e){this.ctx.transceivers&&(this.ctx.transceivers[1].receiver.track.enabled=!e,this.ctx.transceivers[0].receiver.track.enabled=!e)}muteLocal(e){this.ctx.transceivers&&(this.ctx.transceivers[1].sender.track.enabled=!e,this.ctx.transceivers[0].sender.track.enabled=!e)}async showLocalVideo(e){var t;if(we.d(`start to show localvideo with dev id ${e}`),e&&this.setVideoInput(e),!(t=await navigator.mediaDevices.getUserMedia(this.ctx.config.media)))throw new Ee({code:\"1500\",text:\"can not get user media\"});this.ctx.localVideo.srcObject=t,this.ctx.localStream=t,this.ctx.callEvent({name:\"onDisplayUserMedia\",param:t}),null!==this.ctx.transceivers&&this.ctx.transceivers.length>1&&this.ctx.transceivers[1].sender.replaceTrack(this.ctx.localStream.getVideoTracks()[0]),we.d(`finish to show localvideo with dev id ${e}`)}findDevice(e,t){we.d(`start find device ${e}`);for(var n=0;n<t.length;n++)if(t[n].id===e)return n;return we.d(`finish find device ${e}`),-1}setResolution(e,t){this.ctx.config.media.video.width=e,this.ctx.config.media.video.height=t,this.applyRuntime(\"video\")}setFrameRate(e){this.ctx.config.media.video.frameRate=e,this.applyRuntime(\"video\")}setAgc(e){this.ctx.config.media.audio.autoGainControl=e,this.applyRuntime(\"audio\")}setChannelCount(e){this.ctx.config.media.audio.channelCount=e,this.applyRuntime(\"audio\")}setEchoCancellation(e){this.ctx.config.media.audio.echoCancellation=e,this.applyRuntime(\"audio\")}setLatency(e){this.ctx.config.media.audio.latency=e,this.applyRuntime(\"audio\")}setNoiseSuppression(e){this.ctx.config.media.audio.noiseSuppression=e,this.applyRuntime(\"audio\")}setSampleRate(e){this.ctx.config.media.audio.sampleRate=e,this.applyRuntime(\"audio\")}setSampleSize(e){this.ctx.config.media.audio.sampleSize=e,this.applyRuntime(\"audio\")}setVolume(e){this.ctx.config.media.audio.volume=sampleRate,this.applyRuntime(\"audio\"),this.ctx.transceivers&&this.ctx.transceivers[0].receiver.track.applyConstraints({volume:e})}applyRuntime(e){this.ctx.transceivers&&(\"video\"===e?this.ctx.transceivers[1].sender.track.applyConstraints(this.ctx.config.media.video):\"audio\"===e&&this.ctx.transceivers[0].sender.track.applyConstraints(this.ctx.config.media.audio))}}class De{constructor(e){this.interval=5e3,this.statsReportTimer=null,this.context=e}stop(){this._clear()}start(){this._clear(),this.statsReportTimer=window.setInterval(()=>{this.context.signaler.send(this.context.signaler.createMessage({command:\"ping\",body:{}}))},this.interval)}_clear(){this.statsReportTimer&&(window.clearInterval(this.statsReportTimer),this.statsReportTimer=null)}}class Le extends ve{constructor(e){super();try{this.version=ae}catch(e){}if(!e)throw new Ee({code:\"1200\",text:\"no config object\"});this.ctx=new Re,this.ctx.version=this.version,this.ctx.elive=this,this.ctx.config=le(Oe,e),we.init(this.ctx),this.ctx.callEvent=this.onEvent,this.devManager=new Ie(this.ctx),this.ctx.signaler=new _e(this.ctx),\"music\"===this.ctx.config.sdk.audioType&&(this.ctx.config.rtc.opt=ke.getMusicConfiguration()),ke.validateConfig(this.ctx),this.search=this.search.bind(this),this.ctx.health=new De(this.ctx)}async call(e){this.ctx.remoteStream||(this.ctx.remoteStream=new MediaStream),this.ctx.purpose=\"P2P\",0==this.ctx.devices.audioInput.length&&await this.devManager.validateDevices(),await Me(this.ctx),await this.devManager.showLocalVideo(),await this.ctx.signaler.init(),this.ctx.signaler.call(e),we.d(`finish to call the ${e} room`)}async cast(e){this.ctx.localStream||(this.ctx.localStream=new MediaStream),this.ctx.purpose=\"CAST\",0==this.ctx.devices.audioInput.length&&await this.devManager.validateDevices(),await Me(this.ctx),await this.devManager.showLocalVideo(),await this.ctx.signaler.init(),this.ctx.signaler.cast(e),we.d(`finish to cast the ${e} room`)}async watch(e){this.ctx.remoteStream||(this.ctx.remoteStream=new MediaStream),this.ctx.purpose=\"CAST\",this.ctx.remoteMedia=document.querySelector(\"#\"+this.ctx.config.view.remote),await Me(this.ctx),await this.ctx.signaler.init(),this.ctx.signaler.watch(e),we.d(`finish to call the ${e} room`)}async close(){\"CLOSE\"===this.ctx.state&&null===this.ctx.peerConnection||(this.ctx.state=\"CLOSE\",this.ctx.endTime=(new Date).getTime(),we.t(this.ctx,ke.makeTransactionLog(this.ctx)),this.ctx.isConnectToSig=!1,this.ctx.messaging&&this.ctx.messaging.close(),this.ctx.signaler.close(),this.ctx.peerConnection&&await this.ctx.peerConnection.getTransceivers().forEach(e=>e.direction=\"inactive\"),this.ctx.peerConnection&&(this.ctx.peerConnection.close(),this.ctx.peerConnection=null,this.ctx.remoteStream&&this.ctx.remoteStream.getTracks().forEach(e=>this.ctx.remoteStream.removeTrack(e)),this.ctx.transceivers=null,this.ctx.callEvent({name:\"onClose\",param:{channel:this.ctx.channel}}),this.ctx.health.stop()))}sendMessage(e){this.ctx.messaging.sendMessage(e)}onEvent(e){this.elive.emit(e.name,e.param)}setVideoQuality(e){}setFrameRate(e){this.devManager.setFrameRate(e)}setResolution(e,t){this.devManager.setResolution(e,t)}setAgc(e){this.devManager.setAgc(e)}setChannelCount(e){this.devManager.setChannelCount(e)}setEchoCancellation(e){this.devManager.setEchoCancellation(e)}setLatency(e){this.devManager.setLatency(e)}setNoiseSuppression(e){this.devManager.setNoiseSuppression(e)}setSampleSize(e){this.devManager.setSampleSize(e)}setSampleRate(e){this.devManager.setSampleRate(e)}setVolume(e){this.devManager.setVolume(e)}async captureScreen(){this.devManager.captureScreen()}stopCaptureScreen(){this.devManager.stopCaptureScreen()}async setVideoInput(e){0==this.ctx.devices.audioInput.length&&await this.devManager.validateDevices(),this.devManager.setVideoInput(e)}async setAudioInput(e){0==this.ctx.devices.audioInput.length&&await this.devManager.validateDevices(),this.devManager.setAudioInput(e)}async showLocalVideo(e){0==this.ctx.devices.audioInput.length&&await this.devManager.validateDevices(),await this.devManager.showLocalVideo(e)}async switchCamera(){0==this.ctx.devices.audioInput.length&&await this.devManager.validateDevices(),this.devManager.switchCamera()}muteRemote(e){this.devManager.muteRemote(e)}muteLocal(e){this.devManager.muteLocal(e)}getDevices(){return this.ctx.devices}getHealth(){}getState(){}getRoomId(){return this.ctx.channel.id}async search(e){this.ctx.purpose=\"CAST\",this.ctx&&(this.ctx.signaler&&!this.ctx.isConnectToSig&&(await Me(this.ctx),await this.ctx.signaler.init()),this.ctx&&this.ctx.signaler&&this.ctx.signaler.search(e))}status(){return{version:this.version,platform:pe.name,platformVersion:pe.version}}}try{Le.version=ae,Le.env=\"prod\"}catch(ae){Le.version=\"3.0.0\",Le.env={}}new Le({config:{credential:{serviceId:\"simpleapp\",key:\"27f8ca5ee273153d9a9c5944c766fa097d2e16de4dda425a\"},view:{local:\"localVideo\",remote:\"remoteVideo\"}}}).call(\"myCall\")}]);","extractedComments":[]}